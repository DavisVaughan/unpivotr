<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Join a bag of data cells to some header, by proximity in a given direction,
 — join_header • unpivotr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">unpivotr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/nacnudus/unpivotr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Join a bag of data cells to some header, by proximity in a given direction,
</h1>
    </div>

    
    <p>A bag of data cells is a data frame with at least the columns
&#39;row&#39; and &#39;col&#39;, as well as any others that carry information about the
cells, e.g. their values.  Cells in a table are associated with header cells
by proximity.  Having collected header cells and data cells into separate
data frames, &#39;join_header&#39; and the related functions &#39;NNW&#39;, &#39;ABOVE&#39;, etc.,
join the values in the header cells to the data cells, choose the nearest
header to each cell, in a given direction.</p>
    

    <pre><span class='fu'>join_header</span>(<span class='no'>bag</span>, <span class='no'>header</span>, <span class='no'>direction</span>, <span class='kw'>boundaries</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>N</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>E</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>S</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>W</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>NNW</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>NNE</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>ENE</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>ESE</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>SSE</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>SSW</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>WSW</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>WNW</span>(<span class='no'>bag</span>, <span class='no'>header</span>)

<span class='fu'>ABOVE</span>(<span class='no'>bag</span>, <span class='no'>header</span>, <span class='kw'>boundaries</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>LEFT</span>(<span class='no'>bag</span>, <span class='no'>header</span>, <span class='kw'>boundaries</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>BELOW</span>(<span class='no'>bag</span>, <span class='no'>header</span>, <span class='kw'>boundaries</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>RIGHT</span>(<span class='no'>bag</span>, <span class='no'>header</span>, <span class='kw'>boundaries</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <dl class="dl-horizontal">
      <dt>bag</dt>
      <dd>Data frame. A bag of data cells including at least the columns
&#39;row&#39; and &#39;column&#39;, which are numeric/integer vectors.</dd>
      <dt>header</dt>
      <dd>Data frame. A bag of data cells including at least the columns
&#39;row&#39; and &#39;column&#39;, which are numeric/integer vectors.</dd>
      <dt>direction</dt>
      <dd>Character vector length 1. A compass direction to search for
the nearest header.  See &#39;details&#39;.</dd>
      <dt>boundaries</dt>
      <dd>Data frame. Only applies to the directions &quot;ABOVE&quot;,
&quot;RIGHT&quot;, &quot;BELOW&quot; and &quot;LEFT&quot;.  A bag of cells in one row or one column,
demarking boundaries within which to match headers with cells.  For example,
a boundary could be a bag of cells with borders on one side.  This is useful
when the nearest header might be the wrong header because it lies on the
other side of a border.</dd>
    </dl>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Headers are associated with data by proximity in a given direction.
The directions are mapped to the points of the compass, where &#39;N&#39; is north
(up), &#39;E&#39; is east (right), and so on.  `join_header()` finds the nearest
header to a given data cell in a given direction, and joins its value to the
data cell.  The most common directions to search are &#39;NNW&#39; (for left-aligned
headers at the top of the table) and &#39;WNW&#39; for top-aligned headers at the
side of the table.  The difference between &#39;N&#39; and &#39;ABOVE&#39; (and similar pairs
of directions) is that &#39;N&#39; finds headers directly above the data cell,
whereas &#39;ABOVE&#39; matches the nearest header, whether above-left, above-right
or directly above the data cell.  This is useful for matching headers that
are not aligned to the edge of the data cells that they refer to.  There can
be a tie in the directions &#39;ABOVE&#39;, &#39;BELOW&#39;, &#39;LEFT&#39; and &#39;RIGHT&#39; , causing NAs
to be returned in the place of header values.  The full list of available
directions is &#39;N&#39;, &#39;E&#39;, &#39;S&#39;, &#39;W&#39;, &#39;NNW&#39;, &#39;NNE&#39;, &#39;ENE&#39;, &#39;ESE&#39;, &#39;SSE&#39;, &#39;SSW&#39;,
&#39;WSW&#39;, &#39;WNW&#39;, &#39;ABOVE&#39;, &#39;BELOW&#39;, &#39;LEFT&#39;, &#39;RIGHT&#39;.  For convenience, these
directions are provided as their own functions, wrapping the concept of
&#39;join_header()&#39;.</p>
    
    <h2 class="hasAnchor" id="functions"><a class="anchor" href="#functions"></a>Functions</h2>

    <p><ul>
<li> <code>N</code>: Join nearest header in the &#39;N&#39; direction.</p>
    <p></li>
<li> <code>E</code>: Join nearest header in the &#39;E&#39; direction.</p>
    <p></li>
<li> <code>S</code>: Join nearest header in the &#39;S&#39; direction.</p>
    <p></li>
<li> <code>W</code>: Join nearest header in the &#39;W&#39; direction.</p>
    <p></li>
<li> <code>NNW</code>: Join nearest header in the &#39;NNW&#39; direction.</p>
    <p></li>
<li> <code>NNE</code>: Join nearest header in the &#39;NNE&#39; direction.</p>
    <p></li>
<li> <code>ENE</code>: Join nearest header in the &#39;ENE&#39; direction.</p>
    <p></li>
<li> <code>ESE</code>: Join nearest header in the &#39;ESE&#39; direction.</p>
    <p></li>
<li> <code>SSE</code>: Join nearest header in the &#39;SSE&#39; direction.</p>
    <p></li>
<li> <code>SSW</code>: Join nearest header in the &#39;SSW&#39; direction.</p>
    <p></li>
<li> <code>WSW</code>: Join nearest header in the &#39;WSW&#39; direction.</p>
    <p></li>
<li> <code>WNW</code>: Join nearest header in the &#39;WNW&#39; direction.</p>
    <p></li>
<li> <code>ABOVE</code>: Join nearest header in the &#39;ABOVE&#39; direction.</p>
    <p></li>
<li> <code>LEFT</code>: Join nearest header in the &#39;LEFT&#39; direction.</p>
    <p></li>
<li> <code>BELOW</code>: Join nearest header in the &#39;BELOW&#39; direction.</p>
    <p></li>
<li> <code>RIGHT</code>: Join nearest header in the &#39;BELOW&#39; direction.
</li>
</ul></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>library</span>(<span class='no'>dplyr</span>)
<span class='co'># Load some pivoted data</span>
(<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='no'>purpose</span>$<span class='no'>`NNW WNW`</span>)</div><div class='output co'>#&gt;                            X2      X3     X4     X5    X6     X7
#&gt; 1                        &lt;NA&gt;    &lt;NA&gt; Female   &lt;NA&gt;  Male   &lt;NA&gt;
#&gt; 2                        &lt;NA&gt;    &lt;NA&gt;  0 - 6 7 - 10 0 - 6 7 - 10
#&gt; 3           Bachelor&#39;s degree 15 - 24   7000  27000  &lt;NA&gt;  13000
#&gt; 4                        &lt;NA&gt; 25 - 44  12000 137000  9000  81000
#&gt; 5                        &lt;NA&gt; 45 - 64  10000  64000  7000  66000
#&gt; 6                        &lt;NA&gt;     65+   &lt;NA&gt;  18000  7000  17000
#&gt; 7                 Certificate 15 - 24  29000 161000 30000 190000
#&gt; 8                        &lt;NA&gt; 25 - 44  34000 179000 31000 219000
#&gt; 9                        &lt;NA&gt; 45 - 64  30000 210000 23000 199000
#&gt; 10                       &lt;NA&gt;     65+  12000  77000  8000 107000
#&gt; 11                    Diploma 15 - 24   &lt;NA&gt;  14000  9000  11000
#&gt; 12                       &lt;NA&gt; 25 - 44  10000  66000  8000  47000
#&gt; 13                       &lt;NA&gt; 45 - 64   6000  68000  5000  58000
#&gt; 14                       &lt;NA&gt;     65+   5000  41000  1000  34000
#&gt; 15           No Qualification 15 - 24  10000  43000 12000  37000
#&gt; 16                       &lt;NA&gt; 25 - 44  11000  36000 21000  50000
#&gt; 17                       &lt;NA&gt; 45 - 64  19000  91000 17000  75000
#&gt; 18                       &lt;NA&gt;     65+  16000 118000  9000  66000
#&gt; 19 Postgraduate qualification 15 - 24   &lt;NA&gt;   6000  &lt;NA&gt;   &lt;NA&gt;
#&gt; 20                       &lt;NA&gt; 25 - 44   5000  86000  7000  60000
#&gt; 21                       &lt;NA&gt; 45 - 64   6000  55000  6000  68000
#&gt; 22                       &lt;NA&gt;     65+   &lt;NA&gt;  13000  &lt;NA&gt;  18000</div><div class='input'><span class='co'># Make a tidy representation</span>
<span class='no'>cells</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='tidytable.html'>tidytable</a></span>(<span class='no'>x</span>, <span class='fl'>FALSE</span>, <span class='fl'>FALSE</span>)
<span class='no'>cells</span> <span class='kw'>&lt;-</span> <span class='no'>cells</span>[!<span class='fu'>is.na</span>(<span class='no'>cells</span>$<span class='no'>character</span>), ]
<span class='fu'>head</span>(<span class='no'>cells</span>)</div><div class='output co'>#&gt;    row col                  character double integer logical
#&gt; 3    3   1          Bachelor&#39;s degree     NA      NA      NA
#&gt; 7    7   1                Certificate     NA      NA      NA
#&gt; 11  11   1                    Diploma     NA      NA      NA
#&gt; 15  15   1           No Qualification     NA      NA      NA
#&gt; 19  19   1 Postgraduate qualification     NA      NA      NA
#&gt; 25   3   2                    15 - 24     NA      NA      NA</div><div class='input'><span class='co'># Select the cells containing the values</span>
<span class='no'>datacells</span> <span class='kw'>&lt;-</span>
  <span class='no'>cells</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>filter</span>(<span class='no'>row</span> <span class='kw'>&gt;=</span> <span class='fl'>3</span>, <span class='no'>col</span> <span class='kw'>&gt;=</span> <span class='fl'>3</span>)
<span class='fu'>head</span>(<span class='no'>datacells</span>)</div><div class='output co'>#&gt;   row col character double integer logical
#&gt; 1   3   3      7000     NA      NA      NA
#&gt; 2   4   3     12000     NA      NA      NA
#&gt; 3   5   3     10000     NA      NA      NA
#&gt; 4   7   3     29000     NA      NA      NA
#&gt; 5   8   3     34000     NA      NA      NA
#&gt; 6   9   3     30000     NA      NA      NA</div><div class='input'><span class='co'># Select the row headers</span>
<span class='no'>row_headers</span> <span class='kw'>&lt;-</span>
  <span class='no'>cells</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>filter</span>(<span class='no'>col</span> <span class='kw'>&lt;=</span> <span class='fl'>2</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>select</span>(<span class='no'>row</span>, <span class='no'>col</span>, <span class='kw'>header</span> <span class='kw'>=</span> <span class='no'>character</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>split</span>(<span class='no'>.</span>$<span class='no'>col</span>) <span class='co'># Separate each column of headers</span>
<span class='no'>row_headers</span></div><div class='output co'>#&gt; $`1`
#&gt;   row col                     header
#&gt; 1   3   1          Bachelor&#39;s degree
#&gt; 2   7   1                Certificate
#&gt; 3  11   1                    Diploma
#&gt; 4  15   1           No Qualification
#&gt; 5  19   1 Postgraduate qualification
#&gt; 
#&gt; $`2`
#&gt;    row col  header
#&gt; 6    3   2 15 - 24
#&gt; 7    4   2 25 - 44
#&gt; 8    5   2 45 - 64
#&gt; 9    6   2     65+
#&gt; 10   7   2 15 - 24
#&gt; 11   8   2 25 - 44
#&gt; 12   9   2 45 - 64
#&gt; 13  10   2     65+
#&gt; 14  11   2 15 - 24
#&gt; 15  12   2 25 - 44
#&gt; 16  13   2 45 - 64
#&gt; 17  14   2     65+
#&gt; 18  15   2 15 - 24
#&gt; 19  16   2 25 - 44
#&gt; 20  17   2 45 - 64
#&gt; 21  18   2     65+
#&gt; 22  19   2 15 - 24
#&gt; 23  20   2 25 - 44
#&gt; 24  21   2 45 - 64
#&gt; 25  22   2     65+
#&gt; </div><div class='input'><span class='co'># Select the column headers</span>
<span class='no'>col_headers</span> <span class='kw'>&lt;-</span>
  <span class='no'>cells</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>filter</span>(<span class='no'>row</span> <span class='kw'>&lt;=</span> <span class='fl'>2</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>select</span>(<span class='no'>row</span>, <span class='no'>col</span>, <span class='kw'>header</span> <span class='kw'>=</span> <span class='no'>character</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>split</span>(<span class='no'>.</span>$<span class='no'>row</span>) <span class='co'># Separate each row of headers</span>
<span class='no'>col_headers</span></div><div class='output co'>#&gt; $`1`
#&gt;   row col header
#&gt; 1   1   3 Female
#&gt; 4   1   5   Male
#&gt; 
#&gt; $`2`
#&gt;   row col header
#&gt; 2   2   3  0 - 6
#&gt; 3   2   4 7 - 10
#&gt; 5   2   5  0 - 6
#&gt; 6   2   6 7 - 10
#&gt; </div><div class='input'><span class='co'># From each data cell, search for the nearest one of each of the headers</span>
<span class='no'>datacells</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>NNW</span>(<span class='no'>col_headers</span>$<span class='no'>`1`</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>N</span>(<span class='no'>col_headers</span>$<span class='no'>`2`</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>WNW</span>(<span class='no'>row_headers</span>$<span class='no'>`1`</span>) <span class='kw'>%&gt;%</span>
  <span class='fu'>W</span>(<span class='no'>row_headers</span>$<span class='no'>`2`</span>)</div><div class='output co'>#&gt; # A tibble: 72 × 10
#&gt;      row   col character double integer logical header.data header.header
#&gt;    &lt;int&gt; &lt;int&gt;     &lt;chr&gt;  &lt;dbl&gt;   &lt;int&gt;   &lt;lgl&gt;       &lt;chr&gt;         &lt;chr&gt;
#&gt; 1      3     3      7000     NA      NA      NA      Female         0 - 6
#&gt; 2      4     3     12000     NA      NA      NA      Female         0 - 6
#&gt; 3      5     3     10000     NA      NA      NA      Female         0 - 6
#&gt; 4      7     3     29000     NA      NA      NA      Female         0 - 6
#&gt; 5      8     3     34000     NA      NA      NA      Female         0 - 6
#&gt; 6      9     3     30000     NA      NA      NA      Female         0 - 6
#&gt; 7     10     3     12000     NA      NA      NA      Female         0 - 6
#&gt; 8     12     3     10000     NA      NA      NA      Female         0 - 6
#&gt; 9     13     3      6000     NA      NA      NA      Female         0 - 6
#&gt; 10    14     3      5000     NA      NA      NA      Female         0 - 6
#&gt; # ... with 62 more rows, and 2 more variables: header.data.data &lt;chr&gt;,
#&gt; #   header.header.header &lt;chr&gt;</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#functions">Functions</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
