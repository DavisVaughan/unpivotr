<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unpivoting Worked Examples • unpivotr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Unpivoting Worked Examples">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Google analytics --><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45097885-5', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unpivotr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/compass-directions.html">Compass Directions</a>
    </li>
    <li>
      <a href="../articles/html.html">HTML Tables</a>
    </li>
    <li>
      <a href="../articles/small-multiples.html">Small Multiples</a>
    </li>
    <li>
      <a href="../articles/worked-examples.html">Unpivoting Worked Examples</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/nacnudus/unpivotr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Unpivoting Worked Examples</h1>
                        <h4 class="author">Duncan Garmonsway</h4>
            
            <h4 class="date">2018-03-31</h4>
      
      <small>Source: <a href="https://github.com/nacnudus/unpivotr/blob/master/vignettes/worked-examples.Rmd"><code>vignettes/worked-examples.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<div id="load-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-packages" class="anchor"></a>Load packages</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(tibble)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(tidyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="kw">library</span>(tidyxl)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">library</span>(unpivotr)</a></code></pre></div>
<pre><code>## 
## Attaching package: 'unpivotr'</code></pre>
<pre><code>## The following object is masked from 'package:stats':
## 
##     offset</code></pre>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>A spreadsheet of toy data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">path &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>, <span class="st">"worked-examples.xlsx"</span>, <span class="dt">package =</span> <span class="st">"unpivotr"</span>)</a></code></pre></div>
</div>
<div id="clean-tidy-tables" class="section level2">
<h2 class="hasAnchor">
<a href="#clean-tidy-tables" class="anchor"></a>Clean, tidy tables</h2>
<p>If the tables in the spreadsheet are clean and tidy, then you should use a package like <a href="https://github.com/tidyverse/readxl">readxl</a>.</p>
<p>Clean and tidy means: * One table per sheet * A single row of column headers, or no headers * A single data type in each column * Only one kind of sentinel value (to be interpreted as <code>NA</code>) * No meaningful formatting * No data buried in formulas * No need to refer to named ranges</p>
<p>But it’s worth knowing how to emulate readxl with tidyxl and unpivotr, because some <em>almost</em> clean tables can be handled using this technique.</p>
<p>Here’s the full process.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"clean"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, data_type, header, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     Age Name    
##   &lt;dbl&gt; &lt;chr&gt;   
## 1    1. Matilda 
## 2    3. Nicholas
## 3    5. Olivia</code></pre>
<p><code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">tidyxl::xlsx_cells()</a></code> imports the spreadsheet into a data frame, where each row of the data frame describes one cell of the spreadsheet. The columns <code>row</code> and <code>col</code> (and <code>address</code>) describe the position of the cell, and the value of the cell is in one of the columns <code>error</code>, <code>logical</code>, <code>numeric</code>, <code>date</code>, <code>character</code>, depending on the type of data in the cell. The column <code>data_type</code> says which column the value is in. Other columns describe formatting and formulas.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"clean"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##     row   col data_type character numeric
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
## 1     1     1 character Name          NA 
## 2     1     2 character Age           NA 
## 3     2     1 character Matilda       NA 
## 4     2     2 numeric   &lt;NA&gt;           1.
## 5     3     1 character Nicholas      NA 
## 6     3     2 numeric   &lt;NA&gt;           3.
## 7     4     1 character Olivia        NA 
## 8     4     2 numeric   &lt;NA&gt;           5.</code></pre>
<p><code><a href="../reference/behead.html">unpivotr::behead()</a></code> takes one level of headers from a pivot table and makes it part of the data. Think of it like <code><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">tidyr::gather()</a></code>, except that it works when there is more than one row of headers (or more than one column of row-headers), and it only works on tables that have first come through <code><a href="../reference/tidy_table.html">unpivotr::tidy_table()</a></code> or <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">tidyxl::xlsx_cells()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"clean"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##     row   col data_type character numeric header
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; 
## 1     2     1 character Matilda       NA  Name  
## 2     2     2 numeric   &lt;NA&gt;           1. Age   
## 3     3     1 character Nicholas      NA  Name  
## 4     3     2 numeric   &lt;NA&gt;           3. Age   
## 5     4     1 character Olivia        NA  Name  
## 6     4     2 numeric   &lt;NA&gt;           5. Age</code></pre>
<p><code><a href="../reference/spatter.html">unpivotr::spatter()</a></code> spreads key-value pairs across multiple columns, like <code>tidyxl::spread()</code>, except that it handles mixed data types. It knows which column contains the cell value (i.e. the <code>character</code> column or the <code>numeric</code> column), by checking the <code>data_type</code> column. Just like <code><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">tidyr::spread()</a></code>, it can be confused by extraneous data, so it’s usually a good idea to drop the <code>col</code> column first, and to keep the <code>row</code> column.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"clean"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     Age Name    
##   &lt;dbl&gt; &lt;chr&gt;   
## 1    1. Matilda 
## 2    3. Nicholas
## 3    5. Olivia</code></pre>
<p>In case the table has no column headers, you can spatter the <code>col</code> column instead of a nonexistent <code>header</code> column.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"clean"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   `1`        `2`
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Matilda     1.
## 2 Nicholas    3.
## 3 Olivia      5.</code></pre>
<p>Tidyxl and unpivotr are much more complicated than readxl, and that’s the point: tidyxl and unpivotr give you more power and complexity when you need it.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"clean"</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Name       Age
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Matilda     1.
## 2 Nicholas    3.
## 3 Olivia      5.</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"clean"</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>, <span class="dt">skip =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   X__1      X__2
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Matilda     1.
## 2 Nicholas    3.
## 3 Olivia      5.</code></pre>
</div>
<div id="tidy-tables-but-with-gotchas" class="section level2">
<h2 class="hasAnchor">
<a href="#tidy-tables-but-with-gotchas" class="anchor"></a>Tidy tables but with gotchas</h2>
<p>For tables that are already ‘tidy’ (a single row of column headers), use packages like <a href="http://readxl.tidyverse.org">readxl</a> that specialise in importing tidy data.</p>
<p>But even with tidy tables, there can be gotchas.</p>
<div id="transposed-headers-in-the-first-row-data-extends-to-the-right" class="section level3">
<h3 class="hasAnchor">
<a href="#transposed-headers-in-the-first-row-data-extends-to-the-right" class="anchor"></a>Transposed (headers in the first row, data extends to the right)</h3>
<p>Most packages for importing data assume that the headers are in the first row, and each row of data is an observation. They usually don’t support the alternative: headers in the first column, and each column of data is an observation.</p>
<p>You can hack a way around this by importing without recognising any headers, transposing with <code>t()</code> (which outputs a matrix), placing the headers as names, and converting back to a data frame, but this almost always results in all the data types being converted.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"transposed"</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="st">  </span><span class="kw">t</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="st">  `</span><span class="dt">colnames&lt;-</span><span class="st">`</span>(.[<span class="dv">1</span>, ]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="st">  </span>.[<span class="op">-</span><span class="dv">1</span>, ] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tibble/topics/as_tibble">as_tibble</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Name     Age  
##   &lt;chr&gt;    &lt;chr&gt;
## 1 Matilda  1    
## 2 Nicholas 3    
## 3 Olivia   5</code></pre>
<p>Tidyxl and unpivotr are agnostic to the layout of tables. Importing the transpose is the same is importing the usual layout, merely using the <code>W</code> (west) direction instead of <code>N</code> (north) when beheading the headers.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"transposed"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(col, data_type, header, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(Name, Age)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Name       Age
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Matilda     1.
## 2 Nicholas    3.
## 3 Olivia      5.</code></pre>
</div>
<div id="other-stuff-on-the-same-sheet" class="section level3">
<h3 class="hasAnchor">
<a href="#other-stuff-on-the-same-sheet" class="anchor"></a>Other stuff on the same sheet</h3>
<p>TODO: Demonstrate offset() and extend() better. Maybe in a separate section on ‘finding the data’</p>
<p>It will be more complicated when the table doesn’t begin in cell A1, or if there are non-blank cells above, below or either side of the table.</p>
<p>If you know at coding time which rows and columns the table occupies, then you can do the following.</p>
<ul>
<li>Blank or non-blank cells above the table: use the <code>skip</code> argument of <code><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">readxl::read_excel()</a></code>.</li>
<li>Blank or non-blank cells either side of the table: use the <code>col_types</code> argument of <code><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">readxl::read_excel()</a></code> to ignore those columns.</li>
<li>Blank or non-blank cells below the table: use <code>n_max</code> argument of <code><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">readxl::read_excel()</a></code> to ignore those rows.</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">readxl<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path,</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">                   <span class="dt">sheet =</span> <span class="st">"notes"</span>,</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">                   <span class="dt">skip =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">                   <span class="dt">n_max =</span> <span class="dv">33</span>,</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">                   <span class="dt">col_types =</span> <span class="kw">c</span>(<span class="st">"guess"</span>, <span class="st">"guess"</span>, <span class="st">"skip"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/drop_na">drop_na</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   Name       Age
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Matilda     1.
## 2 Nicholas    3.</code></pre>
<p>If you don’t know at coding time which rows and columns the table occupies ( e.g. when the latest version of the spreadsheet is published and the table has moved), then one strategy is to read the spreadsheet with <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">tidyxl::xlsx_cells()</a></code> first, and inspect the results to determine the boundaries of the table. Then use those boundaries as the <code>skip</code>, <code>n_max</code> and <code>col_types</code> arguments to <code><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">readxl::read_excel()</a></code></p>
<ol style="list-style-type: decimal">
<li>Read the spreadsheet with <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">tidyxl::xlsx_cells()</a></code>. Filter the result for sentinel values, e.g. the cells containing the first and final column headers, and a cell in the final row of data.</li>
<li>Construct the arguments <code>skip</code>, <code>n_max</code> and <code>col_types</code> so that <code><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">readxl::read_excel()</a></code> gets the exact dimensions of the table.</li>
</ol>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co"># Step 1: read the spreadsheet and filter for sentinel values to detect the</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="co"># top-left and bottom-right cells</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3">cells &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"notes"</span>)</a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="kw"><a href="../reference/rectify.html">rectify</a></span>(cells)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 5
##   `row/col` `1(A)`     `2(B)`   `3(C)` `4(D)`  
##       &lt;int&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;   
## 1         1 Title text &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;    
## 2         2 &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;    
## 3         3 &lt;NA&gt;       Name     Age    &lt;NA&gt;    
## 4         4 &lt;NA&gt;       Matilda  1      &lt;NA&gt;    
## 5         5 &lt;NA&gt;       Nicholas 3      &lt;NA&gt;    
## 6         6 &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;    
## 7         7 &lt;NA&gt;       &lt;NA&gt;     &lt;NA&gt;   Footnote</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">top_left &lt;-</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cells, character <span class="op">==</span><span class="st"> "Name"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col)</a>
<a class="sourceLine" id="cb31-4" data-line-number="4">top_left</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     row   col
##   &lt;int&gt; &lt;int&gt;
## 1     3     2</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co"># It can be tricky to find the bottom-right cell because you have to make some</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="co"># assumptions.  Here we assume that only cells within the table are numeric.</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3">bottom_right &lt;-</a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span>(<span class="dt">row =</span> <span class="kw">max</span>(row), <span class="dt">col =</span> <span class="kw">max</span>(col))</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">bottom_right</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     row   col
##   &lt;dbl&gt; &lt;dbl&gt;
## 1    5.    3.</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="co"># Alternatively we could assume that every cell in the table has a value, so</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="co"># begin from the top left and move right and down until we meet a blank row or</span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="co"># column.</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4">bottom_right &lt;-</a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/anchor.html">anchor</a></span>(cells, top_left<span class="op">$</span>row, top_left<span class="op">$</span>col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/offset.html">offset_S</a></span>(cells, <span class="dt">boundary =</span> <span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(data_type)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/offset.html">offset_E</a></span>(cells, <span class="dt">boundary =</span> <span class="op">~</span><span class="st"> </span><span class="kw">is.na</span>(data_type)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col)</a>
<a class="sourceLine" id="cb35-9" data-line-number="9">bottom_right</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     row   col
##   &lt;int&gt; &lt;int&gt;
## 1     5     3</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="co"># Step 2: construct the arguments `skip` and `n_max` for read_excel()</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2">skip &lt;-<span class="st"> </span>top_left<span class="op">$</span>row <span class="op">-</span><span class="st"> </span>1L</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">n_rows &lt;-<span class="st"> </span>bottom_right<span class="op">$</span>row <span class="op">-</span><span class="st"> </span>skip</a>
<a class="sourceLine" id="cb37-4" data-line-number="4"></a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"notes"</span>, <span class="dt">skip =</span> skip, <span class="dt">n_max =</span> n_rows)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   Name       Age
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Matilda     1.
## 2 Nicholas    3.</code></pre>
<p>Here’s another way using only tidyxl and unpivotr.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co"># Step 2: filter for cells between the top-left and bottom-right, and spatter</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="co"># into a table</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3">cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/between.html">between</a></span>(row, top_left<span class="op">$</span>row, bottom_right<span class="op">$</span>row),</a>
<a class="sourceLine" id="cb39-5" data-line-number="5">         <span class="kw"><a href="http://dplyr.tidyverse.org/reference/between.html">between</a></span>(col, top_left<span class="op">$</span>col, bottom_right<span class="op">$</span>col)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##     Age Name    
##   &lt;dbl&gt; &lt;chr&gt;   
## 1    1. Matilda 
## 2    3. Nicholas</code></pre>
</div>
</div>
<div id="already-a-tidy-table-but-with-meaningful-formatting-of-whole-rows" class="section level2">
<h2 class="hasAnchor">
<a href="#already-a-tidy-table-but-with-meaningful-formatting-of-whole-rows" class="anchor"></a>Already a tidy table but with meaningful formatting of whole rows</h2>
<p>As with ‘Already a tidy table’, but with a second step to interpret the formatting.</p>
<p>Sometimes whole rows in a table are highlighted by formatting them with, say, a bright yellow fill. The highlighting could mean “this observation should be ignored”, or “this product is no longer available”. Different colours could mean different levels of a hierarchy, e.g. green for “pass” and red for “fail”.</p>
<p>There are three steps to interpreting this.</p>
<ol style="list-style-type: decimal">
<li>Import the table, taking only the cell values and ignoring the formatting.</li>
<li>Import one column of the table, taking only the formatting and not the cell values.</li>
<li>Use <code><a href="http://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_cols()</a></code> to append the column of formatting to the table of cell values. You can then interpret the formatting however you like.</li>
</ol>
<p>Step 1 is the same as “Already a tidy table”.</p>
<p>Step 2 uses <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">tidyxl::xlsx_cells()</a></code> to load the data, <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">tidyxl::xlsx_formats()</a></code>, and several tidyverse functions to link the two and filter for only one column. Why only one column? Because if a whole row is highlighted, then you only need to know the highlighting of one column to know the highlighting of all the others.</p>
<p>This is a special case of the following section, “Meaningful formatting of single cells”. Here <code><a href="http://dplyr.tidyverse.org/reference/bind.html">dplyr::bind_cols()</a></code> can be used as a shortcut, because we are joining exactly <code>n</code> rows of formatting to <code>n</code> rows of data. The following sections is a more general case that can be used instead of this procedure.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="co"># Step 1: import the table taking only cell values and ignoring the formatting</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"highlights"</span>)</a>
<a class="sourceLine" id="cb41-3" data-line-number="3"></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="co"># Step 2: import one column of the table, taking only the formatting and not the</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="co"># cell values</span></a>
<a class="sourceLine" id="cb41-6" data-line-number="6"></a>
<a class="sourceLine" id="cb41-7" data-line-number="7"><span class="co"># `formats` is a pallette of fill colours that can be indexed by the</span></a>
<a class="sourceLine" id="cb41-8" data-line-number="8"><span class="co"># `local_format_id` of a given cell to get the fill colour of that cell</span></a>
<a class="sourceLine" id="cb41-9" data-line-number="9">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb41-10" data-line-number="10"></a>
<a class="sourceLine" id="cb41-11" data-line-number="11"><span class="co"># Import all the cells, filter out the header row, filter for the first column,</span></a>
<a class="sourceLine" id="cb41-12" data-line-number="12"><span class="co"># and create a new column `fill_colour` of the fill colours, by looking up the</span></a>
<a class="sourceLine" id="cb41-13" data-line-number="13"><span class="co"># local_format_id of each cell in the `fill_colours` pallette.</span></a>
<a class="sourceLine" id="cb41-14" data-line-number="14">fills &lt;-</a>
<a class="sourceLine" id="cb41-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"highlights"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>, col <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Omit the header row</span></a>
<a class="sourceLine" id="cb41-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(fill_colour)</a>
<a class="sourceLine" id="cb41-19" data-line-number="19"></a>
<a class="sourceLine" id="cb41-20" data-line-number="20"><span class="co"># Step 3: append the `fill` column to the rest of the data</span></a>
<a class="sourceLine" id="cb41-21" data-line-number="21"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(x, fills) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-22" data-line-number="22"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(Age, Height, fill_colour)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##     Age Height fill_colour
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      
## 1    1.     2. &lt;NA&gt;       
## 2    3.     4. FFFFFF00   
## 3    5.     6. &lt;NA&gt;</code></pre>
<p>Note that the fill colour is expressed as an RGB value with transparency in the first two letters, e.g. <code>FFFFFF00</code> is <code>FF</code> (opaque), with <code>FFFF00</code> (yellow).</p>
<p>Here’s another way using only tidyxl and unpivotr.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb43-2" data-line-number="2"></a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"highlights"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, fill_colour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col, <span class="op">-</span>character) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   fill_colour   Age Height
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;
## 1 &lt;NA&gt;           1.     2.
## 2 FFFFFF00       3.     4.
## 3 &lt;NA&gt;           5.     6.</code></pre>
</div>
<div id="already-a-tidy-table-but-with-meaningful-formatting-of-single-cells" class="section level2">
<h2 class="hasAnchor">
<a href="#already-a-tidy-table-but-with-meaningful-formatting-of-single-cells" class="anchor"></a>Already a tidy table but with meaningful formatting of single cells</h2>
<p>If single cells are highlighted, rather than whole rows, then the highlights probably indicate something about the column rather than the row. For example, a highlighted cell in a column called “age” of a table of medical patients, might mean “the age of this patient is uncertain”.</p>
<p>One way to deal with this is to create a new column in the final table for each column in the original that has any highlighted cells. For example, if highlighted cells mean “this value is uncertain”, and some cells in the <code>age</code> and <code>height</code> columns are highlighted, then you could create two new columns: <code>uncertain_age</code>, and <code>uncertain_height</code>, by following the procedure of “Already a tidy table but with meaningful formatting of whole rows” for each column <code>age</code> and <code>height</code>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="co"># Step 1: import the table taking only cell values and ignoring the formatting</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"annotations"</span>)</a>
<a class="sourceLine" id="cb45-3" data-line-number="3"></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="co"># Step 2: import one column of the table, taking only the formatting and not the</span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="co"># cell values</span></a>
<a class="sourceLine" id="cb45-6" data-line-number="6"></a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="co"># `formats` is a pallette of fill colours that can be indexed by the</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="co"># `local_format_id` of a given cell to get the fill colour of that cell</span></a>
<a class="sourceLine" id="cb45-9" data-line-number="9">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb45-10" data-line-number="10"></a>
<a class="sourceLine" id="cb45-11" data-line-number="11"><span class="co"># Import all the cells, filter out the header row, filter for the first column,</span></a>
<a class="sourceLine" id="cb45-12" data-line-number="12"><span class="co"># and create new columns `something_fill` of the fill colours, by looking up the</span></a>
<a class="sourceLine" id="cb45-13" data-line-number="13"><span class="co"># local_format_id of each cell in the `formats` pallette.</span></a>
<a class="sourceLine" id="cb45-14" data-line-number="14">fills &lt;-</a>
<a class="sourceLine" id="cb45-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>, col <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Omit the header row and name column</span></a>
<a class="sourceLine" id="cb45-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, fill_colour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a></span>(col, fill_colour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/set_names">set_names</a></span>(<span class="kw">paste0</span>(<span class="kw">colnames</span>(x)[<span class="op">-</span><span class="dv">1</span>], <span class="st">"_fill"</span>))</a>
<a class="sourceLine" id="cb45-22" data-line-number="22">fills</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Age_fill Height_fill
##   &lt;chr&gt;    &lt;chr&gt;      
## 1 &lt;NA&gt;     &lt;NA&gt;       
## 2 FFFFFF00 &lt;NA&gt;       
## 3 &lt;NA&gt;     FF92D050</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="co"># Step 3: append the `fill` column to the rest of the data</span></a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(x, fills)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   Name       Age Height Age_fill Height_fill
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      
## 1 Matilda     1.     2. &lt;NA&gt;     &lt;NA&gt;       
## 2 Nicholas    3.     4. FFFFFF00 &lt;NA&gt;       
## 3 Olivia      5.     6. &lt;NA&gt;     FF92D050</code></pre>
<p>Here’s the same thing, but using only tidyxl and unpivotr</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"></a>
<a class="sourceLine" id="cb49-3" data-line-number="3">cells &lt;-</a>
<a class="sourceLine" id="cb49-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb49-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, fill_colour)</a>
<a class="sourceLine" id="cb49-7" data-line-number="7">cells</a></code></pre></div>
<pre><code>## # A tibble: 12 x 6
##      row   col data_type character numeric fill_colour
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;      
##  1     1     1 character Name          NA  &lt;NA&gt;       
##  2     1     2 character Age           NA  &lt;NA&gt;       
##  3     1     3 character Height        NA  &lt;NA&gt;       
##  4     2     1 character Matilda       NA  &lt;NA&gt;       
##  5     2     2 numeric   &lt;NA&gt;           1. &lt;NA&gt;       
##  6     2     3 numeric   &lt;NA&gt;           2. &lt;NA&gt;       
##  7     3     1 character Nicholas      NA  &lt;NA&gt;       
##  8     3     2 numeric   &lt;NA&gt;           3. FFFFFF00   
##  9     3     3 numeric   &lt;NA&gt;           4. &lt;NA&gt;       
## 10     4     1 character Olivia        NA  &lt;NA&gt;       
## 11     4     2 numeric   &lt;NA&gt;           5. &lt;NA&gt;       
## 12     4     3 numeric   &lt;NA&gt;           6. FF92D050</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">values &lt;-</a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>fill_colour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header)</a>
<a class="sourceLine" id="cb51-7" data-line-number="7">values</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##     row   Age Height Name    
##   &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;   
## 1     2    1.     2. Matilda 
## 2     3    3.     4. Nicholas
## 3     4    5.     6. Olivia</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">fills &lt;-</a>
<a class="sourceLine" id="cb53-2" data-line-number="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">header =</span> <span class="kw">paste0</span>(header, <span class="st">"_fill"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, header, fill_colour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a></span>(header, fill_colour)</a>
<a class="sourceLine" id="cb53-7" data-line-number="7">fills</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##     row Age_fill Height_fill Name_fill
##   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;    
## 1     2 &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;     
## 2     3 FFFFFF00 &lt;NA&gt;        &lt;NA&gt;     
## 3     4 &lt;NA&gt;     FF92D050    &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(values, fills, <span class="dt">by =</span> <span class="st">"row"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 6
##     Age Height Name     Age_fill Height_fill Name_fill
##   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;    
## 1    1.     2. Matilda  &lt;NA&gt;     &lt;NA&gt;        &lt;NA&gt;     
## 2    3.     4. Nicholas FFFFFF00 &lt;NA&gt;        &lt;NA&gt;     
## 3    5.     6. Olivia   &lt;NA&gt;     FF92D050    &lt;NA&gt;</code></pre>
<p>Another way would be to make the table what I call “extra-tidy”. If it is tidy, then each row is an observation, and each column is a variable. To make it “extra-tidy”, you <code><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather()</a></code> the variables so that each row is <em>one observation of one variable</em>. This works best when every variable has the same data type, otherwise the values will be coerced, probably to a character.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="co"># Tidy</span></a>
<a class="sourceLine" id="cb57-2" data-line-number="2">(x &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"annotations"</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   Name       Age Height
##   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
## 1 Matilda     1.     2.
## 2 Nicholas    3.     4.
## 3 Olivia      5.     6.</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="co"># Extra-tidy</span></a>
<a class="sourceLine" id="cb59-2" data-line-number="2">extra_tidy &lt;-</a>
<a class="sourceLine" id="cb59-3" data-line-number="3"><span class="st">  </span>x <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb59-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(variable, value, <span class="op">-</span>Name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb59-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(Name, variable)</a>
<a class="sourceLine" id="cb59-6" data-line-number="6">extra_tidy</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   Name     variable value
##   &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;
## 1 Matilda  Age         1.
## 2 Matilda  Height      2.
## 3 Nicholas Age         3.
## 4 Nicholas Height      4.
## 5 Olivia   Age         5.
## 6 Olivia   Height      6.</code></pre>
<p>With an extra-tidy dataset, the formatting can now be appended to the values of individual variables, rather than to whole observations.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb61-1" data-line-number="1"><span class="co"># Extra-tidy, with row and column numbers of the original variables</span></a>
<a class="sourceLine" id="cb61-2" data-line-number="2">extra_tidy &lt;-</a>
<a class="sourceLine" id="cb61-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">row =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>() <span class="op">+</span><span class="st"> </span>1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(variable, value, <span class="op">-</span>row, <span class="op">-</span>Name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">col =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>() <span class="op">+</span><span class="st"> </span>1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, Name, variable, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb61-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(row, col)</a>
<a class="sourceLine" id="cb61-11" data-line-number="11">extra_tidy</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##     row   col Name     variable value
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;
## 1     2     2 Matilda  Age         1.
## 2     2     3 Matilda  Height      2.
## 3     3     2 Nicholas Age         3.
## 4     3     3 Nicholas Height      4.
## 5     4     2 Olivia   Age         5.
## 6     4     3 Olivia   Height      6.</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb63-1" data-line-number="1"><span class="co"># `formats` is a pallette of fill colours that can be indexed by the</span></a>
<a class="sourceLine" id="cb63-2" data-line-number="2"><span class="co"># `local_format_id` of a given cell to get the fill colour of that cell</span></a>
<a class="sourceLine" id="cb63-3" data-line-number="3">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb63-4" data-line-number="4"></a>
<a class="sourceLine" id="cb63-5" data-line-number="5"><span class="co"># Import all the cells, filter out the header row, filter for the first column,</span></a>
<a class="sourceLine" id="cb63-6" data-line-number="6"><span class="co"># and create a new column `uncertain` based on the fill colours, by looking up</span></a>
<a class="sourceLine" id="cb63-7" data-line-number="7"><span class="co"># the local_format_id of each cell in the `formats` pallette.</span></a>
<a class="sourceLine" id="cb63-8" data-line-number="8">fills &lt;-</a>
<a class="sourceLine" id="cb63-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb63-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>, col <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Omit the header row and name column</span></a>
<a class="sourceLine" id="cb63-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb63-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, fill_colour)</a>
<a class="sourceLine" id="cb63-13" data-line-number="13">fills</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##     row   col fill_colour
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
## 1     2     2 &lt;NA&gt;       
## 2     2     3 &lt;NA&gt;       
## 3     3     2 FFFFFF00   
## 4     3     3 &lt;NA&gt;       
## 5     4     2 &lt;NA&gt;       
## 6     4     3 FF92D050</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="co"># Step 3: append the `fill` column to the rest of the data</span></a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(extra_tidy, fills, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##     row   col Name     variable value fill_colour
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;      
## 1     2     2 Matilda  Age         1. &lt;NA&gt;       
## 2     2     3 Matilda  Height      2. &lt;NA&gt;       
## 3     3     2 Nicholas Age         3. FFFFFF00   
## 4     3     3 Nicholas Height      4. &lt;NA&gt;       
## 5     4     2 Olivia   Age         5. &lt;NA&gt;       
## 6     4     3 Olivia   Height      6. FF92D050</code></pre>
<p>Here’s the same extra-tidy version, but using only tidyxl and unpivotr.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb67-2" data-line-number="2"></a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, fill_colour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, Name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>data_type, <span class="op">-</span>character, <span class="dt">value =</span> numeric)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##     row   col value fill_colour Name     variable
##   &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   
## 1     2     2    1. &lt;NA&gt;        Matilda  Age     
## 2     2     3    2. &lt;NA&gt;        Matilda  Height  
## 3     3     2    3. FFFFFF00    Nicholas Age     
## 4     3     3    4. &lt;NA&gt;        Nicholas Height  
## 5     4     2    5. &lt;NA&gt;        Olivia   Age     
## 6     4     3    6. FF92D050    Olivia   Height</code></pre>
</div>
<div id="more-than-one-kind-of-formatting-at-the-same-time" class="section level2">
<h2 class="hasAnchor">
<a href="#more-than-one-kind-of-formatting-at-the-same-time" class="anchor"></a>More than one kind of formatting at the same time</h2>
<p>This could arise in a couple of ways, but the way to deal with it is always the same: read each kind of formatting into a separate column, e.g. fill colour into one column, font colour into another, bold/not-bold into a another, etc.</p>
<p>Sometimes different kinds of formatting relate to clearly different aspects of an observation, e.g. yellow highlight for “uncertain data” and red text for “product no longer available”. Both yellow highlighting and red text in the same row would indicate uncertain data and unavailability of the product at the same time.</p>
<p>When each kind of formatting relates to a different aspect of an observation, import them into different columns as previously.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="co"># Step 1: import the table taking only cell values and ignoring the formatting</span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"combined-highlights"</span>)</a>
<a class="sourceLine" id="cb69-3" data-line-number="3"></a>
<a class="sourceLine" id="cb69-4" data-line-number="4"><span class="co"># Step 2: import one kind of formatting of one column of the table</span></a>
<a class="sourceLine" id="cb69-5" data-line-number="5"></a>
<a class="sourceLine" id="cb69-6" data-line-number="6"><span class="co"># `formats` is a pallette of fill colours that can be indexed by the</span></a>
<a class="sourceLine" id="cb69-7" data-line-number="7"><span class="co"># `local_format_id` of a given cell to get the fill colour of that cell</span></a>
<a class="sourceLine" id="cb69-8" data-line-number="8">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb69-9" data-line-number="9">font_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>color<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb69-10" data-line-number="10"></a>
<a class="sourceLine" id="cb69-11" data-line-number="11"><span class="co"># Import all the cells, filter out the header row, filter for the first column,</span></a>
<a class="sourceLine" id="cb69-12" data-line-number="12"><span class="co"># and create a new column `fill` of the fill colours, by looking up the</span></a>
<a class="sourceLine" id="cb69-13" data-line-number="13"><span class="co"># local_format_id of each cell in the `formats` pallette.</span></a>
<a class="sourceLine" id="cb69-14" data-line-number="14">formats &lt;-</a>
<a class="sourceLine" id="cb69-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"combined-highlights"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>, col <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Omit the header row</span></a>
<a class="sourceLine" id="cb69-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id],</a>
<a class="sourceLine" id="cb69-18" data-line-number="18">         <span class="dt">font_colour =</span> font_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(fill_colour, font_colour)</a>
<a class="sourceLine" id="cb69-20" data-line-number="20"></a>
<a class="sourceLine" id="cb69-21" data-line-number="21"><span class="co"># Step 3: append the `fill` column to the rest of the data</span></a>
<a class="sourceLine" id="cb69-22" data-line-number="22"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(x, formats)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   Name     Weight Price fill_colour font_colour
##   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      
## 1 Knife        7.    8. &lt;NA&gt;        FF000000   
## 2 Fork         5.    6. FFFFFF00    FF000000   
## 3 Spoon        3.    4. &lt;NA&gt;        FFFF0000   
## 4 Teaspoon     1.    2. FFFFFF00    FFFF0000</code></pre>
<p>Here’s the same thing, but using only tidyxl and unpivotr.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb71-2" data-line-number="2">font_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>color<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb71-3" data-line-number="3"></a>
<a class="sourceLine" id="cb71-4" data-line-number="4">cells &lt;-</a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"combined-highlights"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id],</a>
<a class="sourceLine" id="cb71-7" data-line-number="7">         <span class="dt">font_colour =</span> font_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, fill_colour, font_colour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, Name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col, <span class="op">-</span>character)</a>
<a class="sourceLine" id="cb71-12" data-line-number="12"></a>
<a class="sourceLine" id="cb71-13" data-line-number="13">values &lt;-</a>
<a class="sourceLine" id="cb71-14" data-line-number="14"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>fill_colour, <span class="op">-</span>font_colour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a></span>(header, numeric)</a>
<a class="sourceLine" id="cb71-17" data-line-number="17"></a>
<a class="sourceLine" id="cb71-18" data-line-number="18">formats &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(cells, row, fill_colour, font_colour)</a>
<a class="sourceLine" id="cb71-19" data-line-number="19"></a>
<a class="sourceLine" id="cb71-20" data-line-number="20"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(values, formats, <span class="dt">by =</span> <span class="st">"row"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##   data_type Name     Price Weight fill_colour font_colour
##   &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;      
## 1 numeric   Knife       8.     7. &lt;NA&gt;        FF000000   
## 2 numeric   Fork        6.     5. FFFFFF00    &lt;NA&gt;       
## 3 numeric   Spoon       4.     3. &lt;NA&gt;        FFFF0000   
## 4 numeric   Teaspoon    2.     1. FFFFFF00    FFFF0000</code></pre>
<p>Different kinds of formatting might also represent different levels of a hierarchy, e.g.</p>
<table class="table">
<thead><tr class="header">
<th align="left">formatting</th>
<th align="left">interpretation</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">none</td>
<td align="left">good</td>
</tr>
<tr class="even">
<td align="left">italic</td>
<td align="left">satisfactory</td>
</tr>
<tr class="odd">
<td align="left">bold</td>
<td align="left">poor</td>
</tr>
<tr class="even">
<td align="left">bold &amp; italic</td>
<td align="left">fail</td>
</tr>
</tbody>
</table>
<p>When each kind of formatting relates to a different level of one hierarchy, import the different kinds of formatting into different columns, and then combine them into a third column, perhaps using <code>paste()</code>, or <code><a href="http://dplyr.tidyverse.org/reference/case_when.html">case_when()</a></code>.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="co"># Step 1: import the table taking only cell values and ignoring the formatting</span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"highlight-hierarchy"</span>)</a>
<a class="sourceLine" id="cb73-3" data-line-number="3">x</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   Name     Score
##   &lt;chr&gt;    &lt;dbl&gt;
## 1 Matilda     7.
## 2 Nicholas    5.
## 3 Olivia      3.
## 4 Paul        1.</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="co"># Step 2: import one kind of formatting of one column of the table</span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2"></a>
<a class="sourceLine" id="cb75-3" data-line-number="3"><span class="co"># `formats` is a pallette of fill colours that can be indexed by the</span></a>
<a class="sourceLine" id="cb75-4" data-line-number="4"><span class="co"># `local_format_id` of a given cell to get the fill colour of that cell</span></a>
<a class="sourceLine" id="cb75-5" data-line-number="5">bold &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold</a>
<a class="sourceLine" id="cb75-6" data-line-number="6">italic &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>italic</a>
<a class="sourceLine" id="cb75-7" data-line-number="7"></a>
<a class="sourceLine" id="cb75-8" data-line-number="8"><span class="co"># Import all the cells, filter out the header row, filter for the first column,</span></a>
<a class="sourceLine" id="cb75-9" data-line-number="9"><span class="co"># and create a new column `fill` of the fill colours, by looking up the</span></a>
<a class="sourceLine" id="cb75-10" data-line-number="10"><span class="co"># local_format_id of each cell in the `formats` pallette.</span></a>
<a class="sourceLine" id="cb75-11" data-line-number="11">formats &lt;-</a>
<a class="sourceLine" id="cb75-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"highlight-hierarchy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>, col <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Omit the header row</span></a>
<a class="sourceLine" id="cb75-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">bold =</span> bold[local_format_id],</a>
<a class="sourceLine" id="cb75-15" data-line-number="15">         <span class="dt">italic =</span> italic[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">grade =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(bold <span class="op">&amp;</span><span class="st"> </span>italic <span class="op">~</span><span class="st"> "fail"</span>,</a>
<a class="sourceLine" id="cb75-17" data-line-number="17">                           bold <span class="op">~</span><span class="st"> "poor"</span>,</a>
<a class="sourceLine" id="cb75-18" data-line-number="18">                           italic <span class="op">~</span><span class="st"> "satisfactory"</span>,</a>
<a class="sourceLine" id="cb75-19" data-line-number="19">                           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> "good"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(bold, italic, grade)</a>
<a class="sourceLine" id="cb75-21" data-line-number="21"></a>
<a class="sourceLine" id="cb75-22" data-line-number="22"><span class="co"># Step 3: append the `fill` column to the rest of the data</span></a>
<a class="sourceLine" id="cb75-23" data-line-number="23"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(x, formats)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   Name     Score bold  italic grade       
##   &lt;chr&gt;    &lt;dbl&gt; &lt;lgl&gt; &lt;lgl&gt;  &lt;chr&gt;       
## 1 Matilda     7. FALSE FALSE  good        
## 2 Nicholas    5. FALSE TRUE   satisfactory
## 3 Olivia      3. TRUE  FALSE  poor        
## 4 Paul        1. TRUE  TRUE   fail</code></pre>
<p>Here it is again, using only tidyxl and unpivotr.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">bold &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold</a>
<a class="sourceLine" id="cb77-2" data-line-number="2">italic &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>italic</a>
<a class="sourceLine" id="cb77-3" data-line-number="3"></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"highlight-hierarchy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">bold =</span> bold[local_format_id],</a>
<a class="sourceLine" id="cb77-6" data-line-number="6">         <span class="dt">italic =</span> italic[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">grade =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/case_when.html">case_when</a></span>(bold <span class="op">&amp;</span><span class="st"> </span>italic <span class="op">~</span><span class="st"> "fail"</span>,</a>
<a class="sourceLine" id="cb77-8" data-line-number="8">                           bold <span class="op">~</span><span class="st"> "poor"</span>,</a>
<a class="sourceLine" id="cb77-9" data-line-number="9">                           italic <span class="op">~</span><span class="st"> "satisfactory"</span>,</a>
<a class="sourceLine" id="cb77-10" data-line-number="10">                           <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> "good"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, bold, italic, grade) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 6
##     row bold  italic grade        Name     Score
##   &lt;int&gt; &lt;lgl&gt; &lt;lgl&gt;  &lt;chr&gt;        &lt;chr&gt;    &lt;dbl&gt;
## 1     2 FALSE FALSE  good         Matilda     7.
## 2     3 FALSE TRUE   satisfactory Nicholas    5.
## 3     4 TRUE  FALSE  poor         Olivia      3.
## 4     5 TRUE  TRUE   fail         Paul        1.</code></pre>
</div>
<div id="already-a-tidy-table-but-with-text-sentinel-values-in-non-text-columns" class="section level2">
<h2 class="hasAnchor">
<a href="#already-a-tidy-table-but-with-text-sentinel-values-in-non-text-columns" class="anchor"></a>Already a tidy table but with text sentinel values in non-text columns</h2>
<p>R packages like <a href="http://readr.tidyverse.org/">readr</a> recognise <code>NA</code> as a sentinel value that means “Not Applicable”, or “Not Available”, or anything you want. It doesn’t affect the data type of a column when <code>NA</code> is one of the values. Some datasets use other symbols as a sentinel value, e.g. <code>N/A</code> or <code>.</code>, or a combination, in which case you can instruct <code>readr</code> to interpret those values as sentinels, and it will import them all as <code>NA</code>.</p>
<p>But what if the data uses more than one <em>kind</em> of sentinel value. For example, Statistics New Zealand uses <code>…</code> to mean “Not applicable”, and <code>..C</code> to mean “Confidentialised”. Most tools will either regard both values as <code>NA</code>, or coerce the whole column to characters.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv</a></span>(<span class="st">"a, b,   c</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="st">          1, 2,   3</span></a>
<a class="sourceLine" id="cb79-3" data-line-number="3"><span class="st">          4, …, ..C"</span>,</a>
<a class="sourceLine" id="cb79-4" data-line-number="4">         <span class="dt">na =</span> <span class="kw">c</span>(<span class="st">"…"</span>, <span class="st">"..C"</span>)) <span class="co"># Regard both values as NA</span></a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##       a     b     c
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     1     2     3
## 2     4    NA    NA</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">read_csv</a></span>(<span class="st">"a, b,   c</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="st">          1, 2,   3</span></a>
<a class="sourceLine" id="cb81-3" data-line-number="3"><span class="st">          4, …, ..C"</span>,</a>
<a class="sourceLine" id="cb81-4" data-line-number="4">         <span class="dt">na =</span> <span class="st">""</span>)              <span class="co"># Coerce the whole column to characters</span></a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##       a b     c    
##   &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
## 1     1 2     3    
## 2     4 …     ..C</code></pre>
<p>A better procedure is to import the sentinel values into their own column, or even into separate <code>TRUE</code>/<code>FALSE</code> columns for each kind of sentinel.</p>
<p>Note that sentinel values relate the the value in the cell, rather than to the whole row, so the first step is to make the dataset <em>extra-tidy</em> as in the section “Already a tidy table but with meaningful formatting of single cells”.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="co"># Tidy</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"sentinels"</span>)</a>
<a class="sourceLine" id="cb83-3" data-line-number="3">x</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   Name     Subject  Score
##   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;
## 1 Matilda  Music    7    
## 2 Nicholas Classics NA   
## 3 Olivia   …        3    
## 4 Paul     NA       ..C</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"><span class="co"># Extra-tidy</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2">extra_tidy &lt;-</a>
<a class="sourceLine" id="cb85-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(x, variable, value, <span class="op">-</span>Name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(Name, variable)</a>
<a class="sourceLine" id="cb85-5" data-line-number="5">extra_tidy</a></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##   Name     variable value   
##   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1 Matilda  Score    7       
## 2 Matilda  Subject  Music   
## 3 Nicholas Score    NA      
## 4 Nicholas Subject  Classics
## 5 Olivia   Score    3       
## 6 Olivia   Subject  …       
## 7 Paul     Score    ..C     
## 8 Paul     Subject  NA</code></pre>
<p>With an extra-tidy dataset, the sentinels can now be appended to the values of individual variables, rather than to whole observations.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"><span class="co"># Extra-tidy, with row and column numbers of the original variables, and the</span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="co"># sentinels omitted</span></a>
<a class="sourceLine" id="cb87-3" data-line-number="3">extra_tidy &lt;-</a>
<a class="sourceLine" id="cb87-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"sentinels"</span>, <span class="dt">na =</span> <span class="kw">c</span>(<span class="st">"NA"</span>, <span class="st">"…"</span>, <span class="st">"..C"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">row =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>() <span class="op">+</span><span class="st"> </span>1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(variable, value, <span class="op">-</span>row, <span class="op">-</span>Name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">col =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span>() <span class="op">+</span><span class="st"> </span>1L) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, Name, variable, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(row, col)</a>
<a class="sourceLine" id="cb87-12" data-line-number="12">extra_tidy</a></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##     row   col Name     variable value   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1     2     2 Matilda  Subject  Music   
## 2     2     3 Matilda  Score    7       
## 3     3     2 Nicholas Subject  Classics
## 4     3     3 Nicholas Score    &lt;NA&gt;    
## 5     4     2 Olivia   Subject  &lt;NA&gt;    
## 6     4     3 Olivia   Score    3       
## 7     5     2 Paul     Subject  &lt;NA&gt;    
## 8     5     3 Paul     Score    &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"><span class="co"># Import all the cells, and filter for sentinel values</span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2">sentinels &lt;-</a>
<a class="sourceLine" id="cb89-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"sentinels"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(character <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"NA"</span>, <span class="st">"…"</span>, <span class="st">"..C"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">sentinel =</span> character) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb89-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, sentinel)</a>
<a class="sourceLine" id="cb89-7" data-line-number="7">sentinels</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col sentinel
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     3     3 NA      
## 2     4     2 …       
## 3     5     2 NA      
## 4     5     3 ..C</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="co"># Join the `sentinel` column to the rest of the data</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(extra_tidy, sentinels, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>))</a></code></pre></div>
<pre><code>## # A tibble: 8 x 6
##     row   col Name     variable value    sentinel
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   
## 1     2     2 Matilda  Subject  Music    &lt;NA&gt;    
## 2     2     3 Matilda  Score    7        &lt;NA&gt;    
## 3     3     2 Nicholas Subject  Classics &lt;NA&gt;    
## 4     3     3 Nicholas Score    &lt;NA&gt;     NA      
## 5     4     2 Olivia   Subject  &lt;NA&gt;     …       
## 6     4     3 Olivia   Score    3        &lt;NA&gt;    
## 7     5     2 Paul     Subject  &lt;NA&gt;     NA      
## 8     5     3 Paul     Score    &lt;NA&gt;     ..C</code></pre>
<p>Here’s another version using only tidyxl and unpivotr, which provides <code><a href="../reference/isolate_sentinels.html">isolate_sentinels()</a></code> to make this much more straightforward.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"sentinels"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/isolate_sentinels.html">isolate_sentinels</a></span>(character, <span class="kw">c</span>(<span class="st">"NA"</span>, <span class="st">"…"</span>, <span class="st">"..C"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, Name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb93-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(Name, variable, character, numeric, sentinel)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 5
##   Name     variable character numeric sentinel
##   &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
## 1 Matilda  Subject  Music         NA  &lt;NA&gt;    
## 2 Matilda  Score    &lt;NA&gt;           7. &lt;NA&gt;    
## 3 Nicholas Subject  Classics      NA  &lt;NA&gt;    
## 4 Nicholas Score    &lt;NA&gt;          NA  NA      
## 5 Olivia   Subject  &lt;NA&gt;          NA  …       
## 6 Olivia   Score    &lt;NA&gt;           3. &lt;NA&gt;    
## 7 Paul     Subject  &lt;NA&gt;          NA  NA      
## 8 Paul     Score    &lt;NA&gt;          NA  ..C</code></pre>
</div>
<div id="pivot-tables" class="section level2">
<h2 class="hasAnchor">
<a href="#pivot-tables" class="anchor"></a>Pivot tables</h2>
<p>Pivot tables are ones with more than one row of column headers, or more than one column of row headers, or both (and there can be more complex arrangements). Tables in that form take up less space on a page or a screen than ‘tidy’ tables, and are easier for humans to read. But most software can’t interpret or traverse data in that form; it must first be reshaped into a long, ‘tidy’ form, with a single row of column headers.</p>
<p>It takes a lot of code to reshape a pivot table into a ‘tidy’ one, and the code has to be bespoke for each table. There’s no general solution, because it is ambiguous whether a given cell is part of a header or part of the data.</p>
<p>There are some ambiguities in ‘tidy’ tables, too, which is why most functions for reading csv files allow you to specify whether the first row of the data is a header, and how many rows to skip before the data begins. Functions often guess, but they can never be certain.</p>
<p>Pivot tables, being more complex, are so much more ambiguous that it isn’t reasonable to import them with a single function. A better way is to break the problem down into steps:</p>
<ol style="list-style-type: decimal">
<li>Identify which cells are headers, and which are data.</li>
<li>State how the data cells relate to the header cells.</li>
</ol>
<p>The first step is a matter of traversing the cells, which is <em>much easier</em> if you load them with the <a href="https://nacnudus.github.io/tidyxl">tidyxl</a> package, or pass the table through <code><a href="../reference/tidy_table.html">tidy_table()</a></code> in the <a href="https://nacnudus.github.io/unpivotr">unpivotr</a> package. This gives you a table of cells and their properties; one row of the table describes one cell of the source table or spreadsheet. The first two properties are the row and column position of the cell, which makes it easy to filter for cells in a particular region of the spreadsheet. If the first row of cells is a header row, then you can filter for <code>row == 1</code>.</p>
<p>Here is an example of a pivot table where the first two rows, and the first two columns, are headers. The other cells contain the data. First, see how the cells are laid out in the source file by importing it with readxl.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">original &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"pivot-annotations"</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="kw">print</span>(original, <span class="dt">n =</span> <span class="ot">Inf</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   X__1        X__2     X__3    X__4   X__5     X__6 
##   &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;
## 1 &lt;NA&gt;        &lt;NA&gt;     Female  &lt;NA&gt;   Male     &lt;NA&gt; 
## 2 &lt;NA&gt;        &lt;NA&gt;     Matilda Olivia Nicholas Paul 
## 3 Humanities  Classics 1       2      3        0    
## 4 &lt;NA&gt;        History  3       4      5        1    
## 5 Performance Music    5       6      9        2    
## 6 &lt;NA&gt;        Drama    7       8      12       3</code></pre>
<p>Compare that with the long set of cells, one per row, that tidyxl gives. (Only a few properties of each cell are shown, to make it easier to read).</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">cells &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>)</a>
<a class="sourceLine" id="cb97-2" data-line-number="2"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(cells, row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb97-3" data-line-number="3"><span class="st">  </span><span class="kw">print</span>(cells, <span class="dt">n =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## # A tibble: 36 x 5
##      row   col data_type character  numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
##  1     2     2 blank     &lt;NA&gt;           NA 
##  2     2     3 blank     &lt;NA&gt;           NA 
##  3     2     4 character Female         NA 
##  4     2     5 blank     &lt;NA&gt;           NA 
##  5     2     6 character Male           NA 
##  6     2     7 blank     &lt;NA&gt;           NA 
##  7     3     2 blank     &lt;NA&gt;           NA 
##  8     3     3 blank     &lt;NA&gt;           NA 
##  9     3     4 character Matilda        NA 
## 10     3     5 character Olivia         NA 
## 11     3     6 character Nicholas       NA 
## 12     3     7 character Paul           NA 
## 13     4     2 character Humanities     NA 
## 14     4     3 character Classics       NA 
## 15     4     4 numeric   &lt;NA&gt;            1.
## 16     4     5 numeric   &lt;NA&gt;            2.
## 17     4     6 numeric   &lt;NA&gt;            3.
## 18     4     7 numeric   &lt;NA&gt;            0.
## 19     5     2 blank     &lt;NA&gt;           NA 
## 20     5     3 character History        NA 
## # ... with 16 more rows</code></pre>
<p>A similar result is obtained via <code><a href="../reference/tidy_table.html">unpivotr::tidy_table()</a></code>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">original &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"pivot-annotations"</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="kw"><a href="../reference/tidy_table.html">tidy_table</a></span>(original) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(row, col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb99-4" data-line-number="4"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">20</span>)</a></code></pre></div>
<pre><code>## # A tibble: 36 x 4
##      row   col data_type chr       
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;     
##  1     1     1 chr       &lt;NA&gt;      
##  2     1     2 chr       &lt;NA&gt;      
##  3     1     3 chr       Female    
##  4     1     4 chr       &lt;NA&gt;      
##  5     1     5 chr       Male      
##  6     1     6 chr       &lt;NA&gt;      
##  7     2     1 chr       &lt;NA&gt;      
##  8     2     2 chr       &lt;NA&gt;      
##  9     2     3 chr       Matilda   
## 10     2     4 chr       Olivia    
## 11     2     5 chr       Nicholas  
## 12     2     6 chr       Paul      
## 13     3     1 chr       Humanities
## 14     3     2 chr       Classics  
## 15     3     3 chr       1         
## 16     3     4 chr       2         
## 17     3     5 chr       3         
## 18     3     6 chr       0         
## 19     4     1 chr       &lt;NA&gt;      
## 20     4     2 chr       History   
## # ... with 16 more rows</code></pre>
<p>(One difference is that <code><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel()</a></code> has filled in some missing cells with blanks, which <code><a href="../reference/tidy_table.html">tidy_table()</a></code> retains. Another is that <code><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel()</a></code> has coerced all data types to <code>character</code>, whereas <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells()</a></code> preserved the original data types.)</p>
<p>The tidyxl version is easier to traverse, because it describes the position of each cell as well as the value. To filter for the first row of headers:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cells, row <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character, numeric)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##     row   col character numeric
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;
## 1     2     4 Female         NA
## 2     2     6 Male           NA</code></pre>
<p>Or to filter for cells containing data (in this case, we know that only data cells are numeric)</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb103-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, numeric)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##      row   col numeric
##    &lt;int&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     4     4      1.
##  2     4     5      2.
##  3     4     6      3.
##  4     4     7      0.
##  5     5     4      3.
##  6     5     5      4.
##  7     5     6      5.
##  8     5     7      1.
##  9     6     4      5.
## 10     6     5      6.
## 11     6     6      9.
## 12     6     7      2.
## 13     7     4      7.
## 14     7     5      8.
## 15     7     6     12.
## 16     7     7      3.</code></pre>
<p>By identifying the header cells separately from the data cells, and knowing exactly where they are on the sheet, we can associated the data cells with the relevant headers.</p>
<p>To a human it is intuitive that the cells below and to the right of the header <code>Male</code> represent males, and that ones to the right of and below the header <code>Postgraduate qualification</code> represent people with postgraduate qualifications, but it isn’t so obvious to the computer. How would the computer know that the header <code>Male</code> doesn’t also relate to the column of cells below and to the left, beginning with <code>2</code>?</p>
<p>This section shows how you can express the relationships between headers and data cells, using the <a href="https://nacnudus.github.io/unpivotr">unpivotr</a> package.</p>
</div>
<div id="simple-unpivoting" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-unpivoting" class="anchor"></a>Simple unpivoting</h2>
<p>The <code><a href="../reference/behead.html">behead()</a></code> function takes one level of headers from a pivot table and makes it part of the data. Think of it like <code><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">tidyr::gather()</a></code>, except that it works when there is more than one row of headers (or more than one column of row-headers), and it only works on tables that have first come through <code><a href="../reference/tidy_table.html">tidy_table()</a></code> or <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">tidyxl::xlsx_cells()</a></code>.</p>
<div id="two-clear-rows-of-text-column-headers-left-aligned" class="section level3">
<h3 class="hasAnchor">
<a href="#two-clear-rows-of-text-column-headers-left-aligned" class="anchor"></a>Two clear rows of text column headers, left-aligned</h3>
<p>Here we have a pivot table with two rows of column headers. The first row of headers is left-aligned, so <code>"Female"</code> applies to the first two columns of data, and <code>"Male"</code> applies to the next two. The second row of headers has a header in every column.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb105-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(col <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>, <span class="op">!</span>is_blank) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Ignore the row headers in this example</span></a>
<a class="sourceLine" id="cb105-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric)</a>
<a class="sourceLine" id="cb105-5" data-line-number="5">all_cells</a></code></pre></div>
<pre><code>## # A tibble: 22 x 5
##      row   col data_type character numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
##  1     2     4 character Female        NA 
##  2     2     6 character Male          NA 
##  3     3     4 character Matilda       NA 
##  4     3     5 character Olivia        NA 
##  5     3     6 character Nicholas      NA 
##  6     3     7 character Paul          NA 
##  7     4     4 numeric   &lt;NA&gt;           1.
##  8     4     5 numeric   &lt;NA&gt;           2.
##  9     4     6 numeric   &lt;NA&gt;           3.
## 10     4     7 numeric   &lt;NA&gt;           0.
## # ... with 12 more rows</code></pre>
<p>The <code><a href="../reference/behead.html">behead()</a></code> function takes the ‘melted’ output of <code><a href="../reference/tidy_table.html">tidy_table()</a></code>, <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">tidyxl::xlsx_cells()</a></code>, or a previous <code><a href="../reference/behead.html">behead()</a></code>, and three more arguments to specify how the header cells relate to the data cells.</p>
<p>The outermost header is the top row, <code>"Female" NA "Male" NA</code>. The <code>"Female"</code> and <code>"Male"</code> headers are above and to-the-left-of the data cells. We express this as a compass direction, north-north-west, or <code>NNW</code>. We also give the headers a name, <code>sex</code>, and say which column of <code>all_cells</code> contains the value of the header cells – it’s usually the <code>character</code> column.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(NNW, sex)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 6
##      row   col data_type character numeric sex   
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; 
##  1     3     4 character Matilda       NA  Female
##  2     3     5 character Olivia        NA  Female
##  3     3     6 character Nicholas      NA  Male  
##  4     3     7 character Paul          NA  Male  
##  5     4     4 numeric   &lt;NA&gt;           1. Female
##  6     4     5 numeric   &lt;NA&gt;           2. Female
##  7     4     6 numeric   &lt;NA&gt;           3. Male  
##  8     4     7 numeric   &lt;NA&gt;           0. Male  
##  9     5     4 numeric   &lt;NA&gt;           3. Female
## 10     5     5 numeric   &lt;NA&gt;           4. Female
## 11     5     6 numeric   &lt;NA&gt;           5. Male  
## 12     5     7 numeric   &lt;NA&gt;           1. Male  
## 13     6     4 numeric   &lt;NA&gt;           5. Female
## 14     6     5 numeric   &lt;NA&gt;           6. Female
## 15     6     6 numeric   &lt;NA&gt;           9. Male  
## 16     6     7 numeric   &lt;NA&gt;           2. Male  
## 17     7     4 numeric   &lt;NA&gt;           7. Female
## 18     7     5 numeric   &lt;NA&gt;           8. Female
## 19     7     6 numeric   &lt;NA&gt;          12. Male  
## 20     7     7 numeric   &lt;NA&gt;           3. Male</code></pre>
<p>That did half the job. The value 2 in row 4 column 5 is indeed a score of a female. But the value <code>"matilda"</code> in row 3 column 4 isn’t a population – it’s another header. The next step is to strip that second level of column headers. This time, the compass direction is <code>N</code>, because the headers are directly above the associated data cells, and we call it <code>name</code>, because it represents names of people.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1">all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(NNW, sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb109-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, <span class="st">`</span><span class="dt">name</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 7
##      row   col data_type character numeric sex    name    
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   
##  1     4     4 numeric   &lt;NA&gt;           1. Female Matilda 
##  2     4     5 numeric   &lt;NA&gt;           2. Female Olivia  
##  3     4     6 numeric   &lt;NA&gt;           3. Male   Nicholas
##  4     4     7 numeric   &lt;NA&gt;           0. Male   Paul    
##  5     5     4 numeric   &lt;NA&gt;           3. Female Matilda 
##  6     5     5 numeric   &lt;NA&gt;           4. Female Olivia  
##  7     5     6 numeric   &lt;NA&gt;           5. Male   Nicholas
##  8     5     7 numeric   &lt;NA&gt;           1. Male   Paul    
##  9     6     4 numeric   &lt;NA&gt;           5. Female Matilda 
## 10     6     5 numeric   &lt;NA&gt;           6. Female Olivia  
## 11     6     6 numeric   &lt;NA&gt;           9. Male   Nicholas
## 12     6     7 numeric   &lt;NA&gt;           2. Male   Paul    
## 13     7     4 numeric   &lt;NA&gt;           7. Female Matilda 
## 14     7     5 numeric   &lt;NA&gt;           8. Female Olivia  
## 15     7     6 numeric   &lt;NA&gt;          12. Male   Nicholas
## 16     7     7 numeric   &lt;NA&gt;           3. Male   Paul</code></pre>
<p>A final step is a normal clean-up. We drop the <code>row</code>, <code>col</code> and <code>character</code> columns, and we rename the <code>numeric</code> column to <code>score</code>, which is what it represents.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1">all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(NNW, sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb111-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, <span class="st">`</span><span class="dt">name</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb111-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="dt">score =</span> numeric, sex, <span class="st">`</span><span class="dt">name</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    score sex    name    
##    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   
##  1    1. Female Matilda 
##  2    2. Female Olivia  
##  3    3. Male   Nicholas
##  4    0. Male   Paul    
##  5    3. Female Matilda 
##  6    4. Female Olivia  
##  7    5. Male   Nicholas
##  8    1. Male   Paul    
##  9    5. Female Matilda 
## 10    6. Female Olivia  
## 11    9. Male   Nicholas
## 12    2. Male   Paul    
## 13    7. Female Matilda 
## 14    8. Female Olivia  
## 15   12. Male   Nicholas
## 16    3. Male   Paul</code></pre>
</div>
<div id="two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned" class="section level3">
<h3 class="hasAnchor">
<a href="#two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned" class="anchor"></a>Two clear rows and columns of text headers, top-aligned and left-aligned</h3>
<p>There are no new techniques are used, just more compass directions: <code>W</code> for headers directly to the left of the data cells, and <code>WNW</code> for headers left-and-above the data cells.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb113-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb113-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 28 x 5
##      row   col data_type character  numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
##  1     2     4 character Female         NA 
##  2     2     6 character Male           NA 
##  3     3     4 character Matilda        NA 
##  4     3     5 character Olivia         NA 
##  5     3     6 character Nicholas       NA 
##  6     3     7 character Paul           NA 
##  7     4     2 character Humanities     NA 
##  8     4     3 character Classics       NA 
##  9     4     4 numeric   &lt;NA&gt;            1.
## 10     4     5 numeric   &lt;NA&gt;            2.
## # ... with 18 more rows</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(NNW, sex) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># As before</span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, <span class="st">`</span><span class="dt">name</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># As before</span></a>
<a class="sourceLine" id="cb115-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(WNW, field) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Left-and-above</span></a>
<a class="sourceLine" id="cb115-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, subject) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Directly left</span></a>
<a class="sourceLine" id="cb115-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">score =</span> numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb115-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col, <span class="op">-</span>character)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 6
##    data_type score sex    name     field       subject 
##    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;   
##  1 numeric      1. Female Matilda  Humanities  Classics
##  2 numeric      2. Female Olivia   Humanities  Classics
##  3 numeric      3. Male   Nicholas Humanities  Classics
##  4 numeric      0. Male   Paul     Humanities  Classics
##  5 numeric      3. Female Matilda  Humanities  History 
##  6 numeric      4. Female Olivia   Humanities  History 
##  7 numeric      5. Male   Nicholas Humanities  History 
##  8 numeric      1. Male   Paul     Humanities  History 
##  9 numeric      5. Female Matilda  Performance Music   
## 10 numeric      6. Female Olivia   Performance Music   
## 11 numeric      9. Male   Nicholas Performance Music   
## 12 numeric      2. Male   Paul     Performance Music   
## 13 numeric      7. Female Matilda  Performance Drama   
## 14 numeric      8. Female Olivia   Performance Drama   
## 15 numeric     12. Male   Nicholas Performance Drama   
## 16 numeric      3. Male   Paul     Performance Drama</code></pre>
</div>
<div id="multiple-rows-or-columns-of-headers-with-meaningful-formatting" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-rows-or-columns-of-headers-with-meaningful-formatting" class="anchor"></a>Multiple rows or columns of headers, with meaningful formatting</h3>
<p>This is a combination of the previous section with “meaningful formatting of single cells”. The section “meaningful formatting of whole rows” doesn’t work here, because the unpivoting of multiple rows/columns of headers complicates the relationship between the data and the formatting.</p>
<ol style="list-style-type: decimal">
<li>Unpivot the multiple rows/columns of headers, as above, but keep the <code>row</code> and <code>col</code> of each data cell.</li>
<li>Collect the <code>row</code>, <code>col</code> and formatting of each data cell.</li>
<li>Join the data to the formatting by the <code>row</code> and <code>col</code>.</li>
</ol>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb117-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb117-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 28 x 5
##      row   col data_type character  numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
##  1     2     4 character Female         NA 
##  2     2     6 character Male           NA 
##  3     3     4 character Matilda        NA 
##  4     3     5 character Olivia         NA 
##  5     3     6 character Nicholas       NA 
##  6     3     7 character Paul           NA 
##  7     4     2 character Humanities     NA 
##  8     4     3 character Classics       NA 
##  9     4     4 numeric   &lt;NA&gt;            1.
## 10     4     5 numeric   &lt;NA&gt;            2.
## # ... with 18 more rows</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">unpivoted &lt;-</a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="st">  </span>all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(NNW, sex) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># As before</span></a>
<a class="sourceLine" id="cb119-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, <span class="st">`</span><span class="dt">name</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># As before</span></a>
<a class="sourceLine" id="cb119-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(WNW, field) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Left-and-above</span></a>
<a class="sourceLine" id="cb119-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, subject) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Directly left</span></a>
<a class="sourceLine" id="cb119-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">rename</a></span>(<span class="dt">score =</span> numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>character)                <span class="co"># Retain the row and col for now</span></a>
<a class="sourceLine" id="cb119-9" data-line-number="9">unpivoted</a></code></pre></div>
<pre><code>## # A tibble: 16 x 8
##      row   col data_type score sex    name     field       subject 
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;   
##  1     4     4 numeric      1. Female Matilda  Humanities  Classics
##  2     4     5 numeric      2. Female Olivia   Humanities  Classics
##  3     4     6 numeric      3. Male   Nicholas Humanities  Classics
##  4     4     7 numeric      0. Male   Paul     Humanities  Classics
##  5     5     4 numeric      3. Female Matilda  Humanities  History 
##  6     5     5 numeric      4. Female Olivia   Humanities  History 
##  7     5     6 numeric      5. Male   Nicholas Humanities  History 
##  8     5     7 numeric      1. Male   Paul     Humanities  History 
##  9     6     4 numeric      5. Female Matilda  Performance Music   
## 10     6     5 numeric      6. Female Olivia   Performance Music   
## 11     6     6 numeric      9. Male   Nicholas Performance Music   
## 12     6     7 numeric      2. Male   Paul     Performance Music   
## 13     7     4 numeric      7. Female Matilda  Performance Drama   
## 14     7     5 numeric      8. Female Olivia   Performance Drama   
## 15     7     6 numeric     12. Male   Nicholas Performance Drama   
## 16     7     7 numeric      3. Male   Paul     Performance Drama</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="co"># `formats` is a pallette of fill colours that can be indexed by the</span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="co"># `local_format_id` of a given cell to get the fill colour of that cell</span></a>
<a class="sourceLine" id="cb121-3" data-line-number="3">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb121-4" data-line-number="4">fill_colours</a></code></pre></div>
<pre><code>##  [1] NA         NA         NA         NA         "FFFFFF00" NA        
##  [7] "FFFFFF00" NA         NA         NA         "FFFFFF00" "FF92D050"
## [13] NA         NA         NA         "FFFFFF00" NA         NA        
## [19] NA         NA         NA         NA         NA         NA        
## [25] NA         NA         NA         NA         NA         NA        
## [31] NA         "FFFFFF00" "FFFFFF00" NA         NA         NA        
## [37] NA         NA         NA         NA         NA         NA        
## [43] NA         NA         NA         NA         NA         NA        
## [49] NA         NA         NA         NA         NA         NA        
## [55] NA         "FFFFC7CE" NA         NA         NA         NA        
## [61] NA         NA         NA</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="co"># Import all the cells, filter out the header row, filter for the first column,</span></a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="co"># and create a new column `approximate` based on the fill colours, by looking up</span></a>
<a class="sourceLine" id="cb123-3" data-line-number="3"><span class="co"># the local_format_id of each cell in the `formats` pallette.</span></a>
<a class="sourceLine" id="cb123-4" data-line-number="4">annotations &lt;-</a>
<a class="sourceLine" id="cb123-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>, col <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Omit the headers</span></a>
<a class="sourceLine" id="cb123-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb123-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, fill_colour)</a>
<a class="sourceLine" id="cb123-9" data-line-number="9">annotations</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##      row   col fill_colour
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
##  1     4     4 &lt;NA&gt;       
##  2     4     5 FFFFFF00   
##  3     4     6 &lt;NA&gt;       
##  4     4     7 &lt;NA&gt;       
##  5     5     4 FFFFFF00   
##  6     5     5 &lt;NA&gt;       
##  7     5     6 &lt;NA&gt;       
##  8     5     7 &lt;NA&gt;       
##  9     6     4 &lt;NA&gt;       
## 10     6     5 &lt;NA&gt;       
## 11     6     6 &lt;NA&gt;       
## 12     6     7 &lt;NA&gt;       
## 13     7     4 &lt;NA&gt;       
## 14     7     5 &lt;NA&gt;       
## 15     7     6 FFFFFF00   
## 16     7     7 &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(unpivoted, annotations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 7
##    data_type score sex    name     field       subject  fill_colour
##    &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;      
##  1 numeric      1. Female Matilda  Humanities  Classics &lt;NA&gt;       
##  2 numeric      2. Female Olivia   Humanities  Classics FFFFFF00   
##  3 numeric      3. Male   Nicholas Humanities  Classics &lt;NA&gt;       
##  4 numeric      0. Male   Paul     Humanities  Classics &lt;NA&gt;       
##  5 numeric      3. Female Matilda  Humanities  History  FFFFFF00   
##  6 numeric      4. Female Olivia   Humanities  History  &lt;NA&gt;       
##  7 numeric      5. Male   Nicholas Humanities  History  &lt;NA&gt;       
##  8 numeric      1. Male   Paul     Humanities  History  &lt;NA&gt;       
##  9 numeric      5. Female Matilda  Performance Music    &lt;NA&gt;       
## 10 numeric      6. Female Olivia   Performance Music    &lt;NA&gt;       
## 11 numeric      9. Male   Nicholas Performance Music    &lt;NA&gt;       
## 12 numeric      2. Male   Paul     Performance Music    &lt;NA&gt;       
## 13 numeric      7. Female Matilda  Performance Drama    &lt;NA&gt;       
## 14 numeric      8. Female Olivia   Performance Drama    &lt;NA&gt;       
## 15 numeric     12. Male   Nicholas Performance Drama    FFFFFF00   
## 16 numeric      3. Male   Paul     Performance Drama    &lt;NA&gt;</code></pre>
</div>
</div>
<div id="complex-unpivoting" class="section level2">
<h2 class="hasAnchor">
<a href="#complex-unpivoting" class="anchor"></a>Complex unpivoting</h2>
<p>When <code><a href="../reference/behead.html">behead()</a></code> isn’t powerful enough (it makes certain assumptions, and it doesn’t understand formatting), then you can get much more control by using the compass-direction functions <code><a href="../reference/join_header.html">N()</a></code>, <code><a href="../reference/join_header.html">NNW()</a></code> etc. directly.</p>
<p>This kind of unpivoting is always done in two stages.</p>
<ol style="list-style-type: decimal">
<li>Identify which cells are headers, and which are data</li>
<li>State how the data cells relate to the header cells.</li>
</ol>
<div id="two-clear-rows-of-text-column-headers-left-aligned-1" class="section level3">
<h3 class="hasAnchor">
<a href="#two-clear-rows-of-text-column-headers-left-aligned-1" class="anchor"></a>Two clear rows of text column headers, left-aligned</h3>
<p>The first stage, identifying header vs data cells, is simply filtering.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(col <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>, <span class="op">!</span>is_blank) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Ignore the row headers in this example</span></a>
<a class="sourceLine" id="cb127-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 22 x 5
##      row   col data_type character numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
##  1     2     4 character Female        NA 
##  2     2     6 character Male          NA 
##  3     3     4 character Matilda       NA 
##  4     3     5 character Olivia        NA 
##  5     3     6 character Nicholas      NA 
##  6     3     7 character Paul          NA 
##  7     4     4 numeric   &lt;NA&gt;           1.
##  8     4     5 numeric   &lt;NA&gt;           2.
##  9     4     6 numeric   &lt;NA&gt;           3.
## 10     4     7 numeric   &lt;NA&gt;           0.
## # ... with 12 more rows</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="co"># View the cells in their original positions on the spreadsheet</span></a>
<a class="sourceLine" id="cb129-2" data-line-number="2"><span class="kw"><a href="../reference/rectify.html">rectify</a></span>(all_cells)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   `row/col` `4(D)`  `5(E)` `6(F)`   `7(G)`
##       &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; 
## 1         2 Female  &lt;NA&gt;   Male     &lt;NA&gt;  
## 2         3 Matilda Olivia Nicholas Paul  
## 3         4 1       2      3        0     
## 4         5 3       4      5        1     
## 5         6 5       6      9        2     
## 6         7 7       8      12       3</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">first_header_row &lt;-</a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb131-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">sex =</span> character)</a>
<a class="sourceLine" id="cb131-4" data-line-number="4">  <span class="co"># the title of this header is 'sex'</span></a>
<a class="sourceLine" id="cb131-5" data-line-number="5">  <span class="co"># the cells are text cells (`"Female"` and `"Male"`) so take the value in the</span></a>
<a class="sourceLine" id="cb131-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb131-7" data-line-number="7">first_header_row</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col sex   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
## 1     2     4 Female
## 2     2     6 Male</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">second_header_row &lt;-</a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb133-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">name =</span> character)</a>
<a class="sourceLine" id="cb133-4" data-line-number="4">  <span class="co"># The title of this header is 'name'.</span></a>
<a class="sourceLine" id="cb133-5" data-line-number="5">  <span class="co"># The cells are text cells, so take the value in the '`character` column.</span></a>
<a class="sourceLine" id="cb133-6" data-line-number="6">second_header_row</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col name    
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     3     4 Matilda 
## 2     3     5 Olivia  
## 3     3     6 Nicholas
## 4     3     7 Paul</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">data_cells &lt;-</a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">score =</span> numeric)</a>
<a class="sourceLine" id="cb135-4" data-line-number="4">  <span class="co"># The data is exam scores in certain subjects, so give the data that title.</span></a>
<a class="sourceLine" id="cb135-5" data-line-number="5">  <span class="co"># The data is numeric, so select only that 'value'.  If some of the data was</span></a>
<a class="sourceLine" id="cb135-6" data-line-number="6">  <span class="co"># also text or true/false, then you would select the `character` and `logical`</span></a>
<a class="sourceLine" id="cb135-7" data-line-number="7">  <span class="co"># columns as well as `numeric`</span></a></code></pre></div>
<p>The second stage is to declare how the data cells relate to each row of column headers. Unpivotr provides a set of functions for this, derived from the points of the compass.</p>
<p>Starting from the point of view of a data cell, the relevant column header from the second row of headers is the one directly north (up), which is described by the function <code><a href="../reference/join_header.html">N()</a></code>.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="kw"><a href="../reference/join_header.html">N</a></span>(data_cells, second_header_row)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 4
##      row   col score name    
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   
##  1     4     4    1. Matilda 
##  2     4     5    2. Olivia  
##  3     4     6    3. Nicholas
##  4     4     7    0. Paul    
##  5     5     4    3. Matilda 
##  6     5     5    4. Olivia  
##  7     5     6    5. Nicholas
##  8     5     7    1. Paul    
##  9     6     4    5. Matilda 
## 10     6     5    6. Olivia  
## 11     6     6    9. Nicholas
## 12     6     7    2. Paul    
## 13     7     4    7. Matilda 
## 14     7     5    8. Olivia  
## 15     7     6   12. Nicholas
## 16     7     7    3. Paul</code></pre>
<p>The first row of headers, from the point of view of a data cell, is either directly north (up), or north and west (up and left), which is described by the function <code><a href="../reference/join_header.html">NNW()</a></code>.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1"><span class="kw"><a href="../reference/join_header.html">NNW</a></span>(data_cells, first_header_row)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 4
##      row   col score sex   
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; 
##  1     4     4    1. Female
##  2     4     5    2. Female
##  3     4     6    3. Male  
##  4     4     7    0. Male  
##  5     5     4    3. Female
##  6     5     5    4. Female
##  7     5     6    5. Male  
##  8     5     7    1. Male  
##  9     6     4    5. Female
## 10     6     5    6. Female
## 11     6     6    9. Male  
## 12     6     7    2. Male  
## 13     7     4    7. Female
## 14     7     5    8. Female
## 15     7     6   12. Male  
## 16     7     7    3. Male</code></pre>
<p>Piping everything together, we get a complete, tidy dataset, and can finally drop the <code>row</code> and <code>col</code> columns.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" data-line-number="1">data_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">NNW</a></span>(first_header_row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">N</a></span>(second_header_row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb140-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    score sex    name    
##    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   
##  1    1. Female Matilda 
##  2    2. Female Olivia  
##  3    3. Male   Nicholas
##  4    0. Male   Paul    
##  5    3. Female Matilda 
##  6    4. Female Olivia  
##  7    5. Male   Nicholas
##  8    1. Male   Paul    
##  9    5. Female Matilda 
## 10    6. Female Olivia  
## 11    9. Male   Nicholas
## 12    2. Male   Paul    
## 13    7. Female Matilda 
## 14    8. Female Olivia  
## 15   12. Male   Nicholas
## 16    3. Male   Paul</code></pre>
</div>
<div id="two-clear-columns-of-text-row-headers-top-aligned" class="section level3">
<h3 class="hasAnchor">
<a href="#two-clear-columns-of-text-row-headers-top-aligned" class="anchor"></a>Two clear columns of text row headers, top-aligned</h3>
<p>This is almost the same as “Two clear rows of text column headers, left-aligned”, but with different compass directions: <code><a href="../reference/join_header.html">W()</a></code> for directly west (left), and <code><a href="../reference/join_header.html">WNW()</a></code> for west and north (left and up).</p>
<p>(<code><a href="../reference/join_header.html">NNW()</a></code> and <code><a href="../reference/join_header.html">WNW()</a></code> look like synonyms, but behave differently in some special cases. See “Headers amongst the data”)</p>
<p>In this example, the table has no column headers, only row headers. This is artificial here, but sometimes table are deliberately laid out in transpose form: the first column contains the headers, and the data extends in columns from left to right instead of from top to bottom.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb142-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span>, <span class="op">!</span>is_blank) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Ignore the column headers in this example</span></a>
<a class="sourceLine" id="cb142-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 26 x 5
##      row   col data_type character  numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
##  1     3     4 character Matilda        NA 
##  2     3     5 character Olivia         NA 
##  3     3     6 character Nicholas       NA 
##  4     3     7 character Paul           NA 
##  5     4     2 character Humanities     NA 
##  6     4     3 character Classics       NA 
##  7     4     4 numeric   &lt;NA&gt;            1.
##  8     4     5 numeric   &lt;NA&gt;            2.
##  9     4     6 numeric   &lt;NA&gt;            3.
## 10     4     7 numeric   &lt;NA&gt;            0.
## # ... with 16 more rows</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="co"># View the cells in their original positions on the spreadsheet</span></a>
<a class="sourceLine" id="cb144-2" data-line-number="2"><span class="kw"><a href="../reference/rectify.html">rectify</a></span>(all_cells)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   `row/col` `2(B)`      `3(C)`   `4(D)`  `5(E)` `6(F)`   `7(G)`
##       &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; 
## 1         3 &lt;NA&gt;        &lt;NA&gt;     Matilda Olivia Nicholas Paul  
## 2         4 Humanities  Classics 1       2      3        0     
## 3         5 &lt;NA&gt;        History  3       4      5        1     
## 4         6 Performance Music    5       6      9        2     
## 5         7 &lt;NA&gt;        Drama    7       8      12       3</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">first_header_col &lt;-</a>
<a class="sourceLine" id="cb146-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb146-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">field =</span> character)</a>
<a class="sourceLine" id="cb146-4" data-line-number="4">  <span class="co"># the title of this header is 'field', meaning 'group of subjects'.</span></a>
<a class="sourceLine" id="cb146-5" data-line-number="5">  <span class="co"># The cells are text cells (`"Humanities"`, `"Performance"`) so take the value</span></a>
<a class="sourceLine" id="cb146-6" data-line-number="6">  <span class="co"># in the '`character` column.</span></a>
<a class="sourceLine" id="cb146-7" data-line-number="7">first_header_col</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col field      
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
## 1     4     2 Humanities 
## 2     6     2 Performance</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1">second_header_col &lt;-</a>
<a class="sourceLine" id="cb148-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb148-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">subject =</span> character)</a>
<a class="sourceLine" id="cb148-4" data-line-number="4">  <span class="co"># The title of this header is 'subject'</span></a>
<a class="sourceLine" id="cb148-5" data-line-number="5">  <span class="co"># The cells are text cells (`"history"`, etc.) so take the value in the</span></a>
<a class="sourceLine" id="cb148-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb148-7" data-line-number="7">second_header_col</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col subject 
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     4     3 Classics
## 2     5     3 History 
## 3     6     3 Music   
## 4     7     3 Drama</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">data_cells &lt;-</a>
<a class="sourceLine" id="cb150-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">score =</span> numeric)</a>
<a class="sourceLine" id="cb150-4" data-line-number="4">  <span class="co"># The data is examp scores in certain subjects, so give the data that title.</span></a>
<a class="sourceLine" id="cb150-5" data-line-number="5">  <span class="co"># The data is numeric, so select only that 'value'.  If some of the data was</span></a>
<a class="sourceLine" id="cb150-6" data-line-number="6">  <span class="co"># also text or true/false, then you would select the `character` and `logical`</span></a>
<a class="sourceLine" id="cb150-7" data-line-number="7">  <span class="co"># columns as well as `numeric`</span></a>
<a class="sourceLine" id="cb150-8" data-line-number="8"></a>
<a class="sourceLine" id="cb150-9" data-line-number="9">data_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">WNW</a></span>(first_header_col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">W</a></span>(second_header_col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb150-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    score field       subject 
##    &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;   
##  1    1. Humanities  Classics
##  2    2. Humanities  Classics
##  3    3. Humanities  Classics
##  4    0. Humanities  Classics
##  5    3. Humanities  History 
##  6    4. Humanities  History 
##  7    5. Humanities  History 
##  8    1. Humanities  History 
##  9    5. Performance Music   
## 10    6. Performance Music   
## 11    9. Performance Music   
## 12    2. Performance Music   
## 13    7. Performance Drama   
## 14    8. Performance Drama   
## 15   12. Performance Drama   
## 16    3. Performance Drama</code></pre>
</div>
<div id="two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned-1" class="section level3">
<h3 class="hasAnchor">
<a href="#two-clear-rows-and-columns-of-text-headers-top-aligned-and-left-aligned-1" class="anchor"></a>Two clear rows and columns of text headers, top-aligned and left-aligned</h3>
<p>This is a combination of the previous two sections. No new techniques are used.</p>
<ol style="list-style-type: decimal">
<li>Identify which cells are headers, and which are data</li>
<li>State how the data cells relate to the header cells.</li>
</ol>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb152-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 28 x 5
##      row   col data_type character  numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
##  1     2     4 character Female         NA 
##  2     2     6 character Male           NA 
##  3     3     4 character Matilda        NA 
##  4     3     5 character Olivia         NA 
##  5     3     6 character Nicholas       NA 
##  6     3     7 character Paul           NA 
##  7     4     2 character Humanities     NA 
##  8     4     3 character Classics       NA 
##  9     4     4 numeric   &lt;NA&gt;            1.
## 10     4     5 numeric   &lt;NA&gt;            2.
## # ... with 18 more rows</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1"><span class="co"># View the cells in their original positions on the spreadsheet</span></a>
<a class="sourceLine" id="cb154-2" data-line-number="2"><span class="kw"><a href="../reference/rectify.html">rectify</a></span>(all_cells)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   `row/col` `2(B)`      `3(C)`   `4(D)`  `5(E)` `6(F)`   `7(G)`
##       &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; 
## 1         2 &lt;NA&gt;        &lt;NA&gt;     Female  &lt;NA&gt;   Male     &lt;NA&gt;  
## 2         3 &lt;NA&gt;        &lt;NA&gt;     Matilda Olivia Nicholas Paul  
## 3         4 Humanities  Classics 1       2      3        0     
## 4         5 &lt;NA&gt;        History  3       4      5        1     
## 5         6 Performance Music    5       6      9        2     
## 6         7 &lt;NA&gt;        Drama    7       8      12       3</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">first_header_row &lt;-</a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb156-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">sex =</span> character)</a>
<a class="sourceLine" id="cb156-4" data-line-number="4">  <span class="co"># the title of this header is 'sex'</span></a>
<a class="sourceLine" id="cb156-5" data-line-number="5">  <span class="co"># the cells are text cells (`"Female"` and `"Male"`) so take the value in the</span></a>
<a class="sourceLine" id="cb156-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb156-7" data-line-number="7">first_header_row</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col sex   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
## 1     2     4 Female
## 2     2     6 Male</code></pre>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">second_header_row &lt;-</a>
<a class="sourceLine" id="cb158-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb158-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">name =</span> character)</a>
<a class="sourceLine" id="cb158-4" data-line-number="4">  <span class="co"># The title of this header is 'name'.</span></a>
<a class="sourceLine" id="cb158-5" data-line-number="5">  <span class="co"># The cells are text cells, so take the value in the '`character` column.</span></a>
<a class="sourceLine" id="cb158-6" data-line-number="6">second_header_row</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col name    
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     3     4 Matilda 
## 2     3     5 Olivia  
## 3     3     6 Nicholas
## 4     3     7 Paul</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1">first_header_col &lt;-</a>
<a class="sourceLine" id="cb160-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb160-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">field =</span> character)</a>
<a class="sourceLine" id="cb160-4" data-line-number="4">  <span class="co"># the title of this header is 'field', meaning 'group of subjects'.</span></a>
<a class="sourceLine" id="cb160-5" data-line-number="5">  <span class="co"># The cells are text cells (`"Humanities"`, `"Performance"`) so take the value</span></a>
<a class="sourceLine" id="cb160-6" data-line-number="6">  <span class="co"># in the '`character` column.</span></a>
<a class="sourceLine" id="cb160-7" data-line-number="7">first_header_col</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col field      
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
## 1     4     2 Humanities 
## 2     6     2 Performance</code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">second_header_col &lt;-</a>
<a class="sourceLine" id="cb162-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">subject =</span> character)</a>
<a class="sourceLine" id="cb162-4" data-line-number="4">  <span class="co"># The title of this header is 'subject'</span></a>
<a class="sourceLine" id="cb162-5" data-line-number="5">  <span class="co"># The cells are text cells (`"history"`, etc.) so take the value in the</span></a>
<a class="sourceLine" id="cb162-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb162-7" data-line-number="7">second_header_col</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col subject 
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     4     3 Classics
## 2     5     3 History 
## 3     6     3 Music   
## 4     7     3 Drama</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">data_cells &lt;-</a>
<a class="sourceLine" id="cb164-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">score =</span> numeric)</a>
<a class="sourceLine" id="cb164-4" data-line-number="4">  <span class="co"># The data is examp scores in certain subjects, so give the data that title.</span></a>
<a class="sourceLine" id="cb164-5" data-line-number="5">  <span class="co"># The data is numeric, so select only that 'value'.  If some of the data was</span></a>
<a class="sourceLine" id="cb164-6" data-line-number="6">  <span class="co"># also text or true/false, then you would select the `character` and `logical`</span></a>
<a class="sourceLine" id="cb164-7" data-line-number="7">  <span class="co"># columns as well as `numeric`</span></a>
<a class="sourceLine" id="cb164-8" data-line-number="8"></a>
<a class="sourceLine" id="cb164-9" data-line-number="9">data_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">NNW</a></span>(first_header_row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">N</a></span>(second_header_row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">WNW</a></span>(first_header_col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">W</a></span>(second_header_col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb164-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 5
##    score sex    name     field       subject 
##    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;   
##  1    1. Female Matilda  Humanities  Classics
##  2    2. Female Olivia   Humanities  Classics
##  3    3. Male   Nicholas Humanities  Classics
##  4    0. Male   Paul     Humanities  Classics
##  5    3. Female Matilda  Humanities  History 
##  6    4. Female Olivia   Humanities  History 
##  7    5. Male   Nicholas Humanities  History 
##  8    1. Male   Paul     Humanities  History 
##  9    5. Female Matilda  Performance Music   
## 10    6. Female Olivia   Performance Music   
## 11    9. Male   Nicholas Performance Music   
## 12    2. Male   Paul     Performance Music   
## 13    7. Female Matilda  Performance Drama   
## 14    8. Female Olivia   Performance Drama   
## 15   12. Male   Nicholas Performance Drama   
## 16    3. Male   Paul     Performance Drama</code></pre>
</div>
<div id="multiple-rows-or-columns-of-headers-with-meaningful-formatting-1" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-rows-or-columns-of-headers-with-meaningful-formatting-1" class="anchor"></a>Multiple rows or columns of headers, with meaningful formatting</h3>
<p>This is a combination of the previous section with “meaningful formatting of single cells”. The section “meaningful formatting of whole rows” doesn’t work here, because the unpivoting of multiple rows/columns of headers complicates the relationship between the data and the formatting.</p>
<ol style="list-style-type: decimal">
<li>Unpivot the multiple rows/columns of headers, as above, but keep the <code>row</code> and <code>col</code> of each data cell.</li>
<li>Collect the <code>row</code>, <code>col</code> and formatting of each data cell.</li>
<li>Join the data to the formatting by the <code>row</code> and <code>col</code>.</li>
</ol>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb166-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb166-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb166-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 28 x 5
##      row   col data_type character  numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
##  1     2     4 character Female         NA 
##  2     2     6 character Male           NA 
##  3     3     4 character Matilda        NA 
##  4     3     5 character Olivia         NA 
##  5     3     6 character Nicholas       NA 
##  6     3     7 character Paul           NA 
##  7     4     2 character Humanities     NA 
##  8     4     3 character Classics       NA 
##  9     4     4 numeric   &lt;NA&gt;            1.
## 10     4     5 numeric   &lt;NA&gt;            2.
## # ... with 18 more rows</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1"><span class="co"># View the cells in their original positions on the spreadsheet</span></a>
<a class="sourceLine" id="cb168-2" data-line-number="2"><span class="kw"><a href="../reference/rectify.html">rectify</a></span>(all_cells)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##   `row/col` `2(B)`      `3(C)`   `4(D)`  `5(E)` `6(F)`   `7(G)`
##       &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; 
## 1         2 &lt;NA&gt;        &lt;NA&gt;     Female  &lt;NA&gt;   Male     &lt;NA&gt;  
## 2         3 &lt;NA&gt;        &lt;NA&gt;     Matilda Olivia Nicholas Paul  
## 3         4 Humanities  Classics 1       2      3        0     
## 4         5 &lt;NA&gt;        History  3       4      5        1     
## 5         6 Performance Music    5       6      9        2     
## 6         7 &lt;NA&gt;        Drama    7       8      12       3</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1">first_header_row &lt;-</a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb170-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">sex =</span> character)</a>
<a class="sourceLine" id="cb170-4" data-line-number="4">  <span class="co"># the title of this header is 'sex'</span></a>
<a class="sourceLine" id="cb170-5" data-line-number="5">  <span class="co"># the cells are text cells (`"Female"` and `"Male"`) so take the value in the</span></a>
<a class="sourceLine" id="cb170-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb170-7" data-line-number="7">first_header_row</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col sex   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
## 1     2     4 Female
## 2     2     6 Male</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1">second_header_row &lt;-</a>
<a class="sourceLine" id="cb172-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb172-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">name =</span> character)</a>
<a class="sourceLine" id="cb172-4" data-line-number="4">  <span class="co"># The title of this header is 'name'.</span></a>
<a class="sourceLine" id="cb172-5" data-line-number="5">  <span class="co"># The cells are text cells, so take the value in the '`character` column.</span></a>
<a class="sourceLine" id="cb172-6" data-line-number="6">second_header_row</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col name    
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     3     4 Matilda 
## 2     3     5 Olivia  
## 3     3     6 Nicholas
## 4     3     7 Paul</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1">first_header_col &lt;-</a>
<a class="sourceLine" id="cb174-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb174-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">field =</span> character)</a>
<a class="sourceLine" id="cb174-4" data-line-number="4">  <span class="co"># the title of this header is 'field', meaning 'group of subjects'.</span></a>
<a class="sourceLine" id="cb174-5" data-line-number="5">  <span class="co"># The cells are text cells (`"Humanities"`, `"Performance"`) so take the value</span></a>
<a class="sourceLine" id="cb174-6" data-line-number="6">  <span class="co"># in the '`character` column.</span></a>
<a class="sourceLine" id="cb174-7" data-line-number="7">first_header_col</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col field      
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
## 1     4     2 Humanities 
## 2     6     2 Performance</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1">second_header_col &lt;-</a>
<a class="sourceLine" id="cb176-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb176-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">subject =</span> character)</a>
<a class="sourceLine" id="cb176-4" data-line-number="4">  <span class="co"># The title of this header is 'subject'</span></a>
<a class="sourceLine" id="cb176-5" data-line-number="5">  <span class="co"># The cells are text cells (`"history"`, etc.) so take the value in the</span></a>
<a class="sourceLine" id="cb176-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb176-7" data-line-number="7">second_header_col</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col subject 
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     4     3 Classics
## 2     5     3 History 
## 3     6     3 Music   
## 4     7     3 Drama</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1">data_cells &lt;-</a>
<a class="sourceLine" id="cb178-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">score =</span> numeric)</a>
<a class="sourceLine" id="cb178-4" data-line-number="4">  <span class="co"># The data is exam scores in certain subjects, so give the data that title.</span></a>
<a class="sourceLine" id="cb178-5" data-line-number="5">  <span class="co"># The data is numeric, so select only that 'value'.  If some of the data was</span></a>
<a class="sourceLine" id="cb178-6" data-line-number="6">  <span class="co"># also text or true/false, then you would select the `character` and `logical`</span></a>
<a class="sourceLine" id="cb178-7" data-line-number="7">  <span class="co"># columns as well as `numeric`</span></a>
<a class="sourceLine" id="cb178-8" data-line-number="8"></a>
<a class="sourceLine" id="cb178-9" data-line-number="9">unpivoted &lt;-</a>
<a class="sourceLine" id="cb178-10" data-line-number="10"><span class="st">  </span>data_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">NNW</a></span>(first_header_row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">N</a></span>(second_header_row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">WNW</a></span>(first_header_col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">W</a></span>(second_header_col)</a>
<a class="sourceLine" id="cb178-15" data-line-number="15">  <span class="co"># Don't delet the `row` and `col` columns yet, because we need them to join on</span></a>
<a class="sourceLine" id="cb178-16" data-line-number="16">  <span class="co"># the formatting</span></a>
<a class="sourceLine" id="cb178-17" data-line-number="17"></a>
<a class="sourceLine" id="cb178-18" data-line-number="18"><span class="co"># `formats` is a pallette of fill colours that can be indexed by the</span></a>
<a class="sourceLine" id="cb178-19" data-line-number="19"><span class="co"># `local_format_id` of a given cell to get the fill colour of that cell</span></a>
<a class="sourceLine" id="cb178-20" data-line-number="20">fill_colours &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb178-21" data-line-number="21"></a>
<a class="sourceLine" id="cb178-22" data-line-number="22"><span class="co"># Import all the cells, filter out the header row, filter for the first column,</span></a>
<a class="sourceLine" id="cb178-23" data-line-number="23"><span class="co"># and create a new column `approximate` based on the fill colours, by looking up</span></a>
<a class="sourceLine" id="cb178-24" data-line-number="24"><span class="co"># the local_format_id of each cell in the `formats` pallette.</span></a>
<a class="sourceLine" id="cb178-25" data-line-number="25">annotations &lt;-</a>
<a class="sourceLine" id="cb178-26" data-line-number="26"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-annotations"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-27" data-line-number="27"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>, col <span class="op">&gt;=</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Omit the headers</span></a>
<a class="sourceLine" id="cb178-28" data-line-number="28"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">fill_colour =</span> fill_colours[local_format_id]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb178-29" data-line-number="29"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, fill_colour)</a>
<a class="sourceLine" id="cb178-30" data-line-number="30">annotations</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##      row   col fill_colour
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
##  1     4     4 &lt;NA&gt;       
##  2     4     5 FFFFFF00   
##  3     4     6 &lt;NA&gt;       
##  4     4     7 &lt;NA&gt;       
##  5     5     4 FFFFFF00   
##  6     5     5 &lt;NA&gt;       
##  7     5     6 &lt;NA&gt;       
##  8     5     7 &lt;NA&gt;       
##  9     6     4 &lt;NA&gt;       
## 10     6     5 &lt;NA&gt;       
## 11     6     6 &lt;NA&gt;       
## 12     6     7 &lt;NA&gt;       
## 13     7     4 &lt;NA&gt;       
## 14     7     5 &lt;NA&gt;       
## 15     7     6 FFFFFF00   
## 16     7     7 &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(unpivoted, annotations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"row"</span>, <span class="st">"col"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb180-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 6
##    score sex    name     field       subject  fill_colour
##    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;      
##  1    1. Female Matilda  Humanities  Classics &lt;NA&gt;       
##  2    2. Female Olivia   Humanities  Classics FFFFFF00   
##  3    3. Male   Nicholas Humanities  Classics &lt;NA&gt;       
##  4    0. Male   Paul     Humanities  Classics &lt;NA&gt;       
##  5    3. Female Matilda  Humanities  History  FFFFFF00   
##  6    4. Female Olivia   Humanities  History  &lt;NA&gt;       
##  7    5. Male   Nicholas Humanities  History  &lt;NA&gt;       
##  8    1. Male   Paul     Humanities  History  &lt;NA&gt;       
##  9    5. Female Matilda  Performance Music    &lt;NA&gt;       
## 10    6. Female Olivia   Performance Music    &lt;NA&gt;       
## 11    9. Male   Nicholas Performance Music    &lt;NA&gt;       
## 12    2. Male   Paul     Performance Music    &lt;NA&gt;       
## 13    7. Female Matilda  Performance Drama    &lt;NA&gt;       
## 14    8. Female Olivia   Performance Drama    &lt;NA&gt;       
## 15   12. Male   Nicholas Performance Drama    FFFFFF00   
## 16    3. Male   Paul     Performance Drama    &lt;NA&gt;</code></pre>
</div>
<div id="mixed-headers-and-notes-in-the-same-rowcolumn-distinguished-by-formatting" class="section level3">
<h3 class="hasAnchor">
<a href="#mixed-headers-and-notes-in-the-same-rowcolumn-distinguished-by-formatting" class="anchor"></a>Mixed headers and notes in the same row/column, distinguished by formatting</h3>
<p>This doesn’t use any new techniques. The trick is, when selecting a row or column of header cells, to filter out ones that have the ‘wrong’ formatting (formatting that shows they aren’t really headers). In this example, cells with italic or red text aren’t headers, even if they are in amongst header cells.</p>
<p>First, identify the IDs of formats that have italic or red text.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1">formats &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)</a>
<a class="sourceLine" id="cb182-2" data-line-number="2"></a>
<a class="sourceLine" id="cb182-3" data-line-number="3">italic &lt;-<span class="st"> </span><span class="kw">which</span>(formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>italic)</a>
<a class="sourceLine" id="cb182-4" data-line-number="4"></a>
<a class="sourceLine" id="cb182-5" data-line-number="5"><span class="co"># For 'red' we can either look for the RGB code for red "FFFF0000"</span></a>
<a class="sourceLine" id="cb182-6" data-line-number="6">red &lt;-<span class="st"> </span><span class="kw">which</span>(formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>color<span class="op">$</span>rgb <span class="op">==</span><span class="st"> "FFFF0000"</span>)</a>
<a class="sourceLine" id="cb182-7" data-line-number="7">red</a></code></pre></div>
<pre><code>## [1]  4 10 11 18 34</code></pre>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="co"># Or we can find out what that code is by starting from a cell that we know is</span></a>
<a class="sourceLine" id="cb184-2" data-line-number="2"><span class="co"># red.</span></a>
<a class="sourceLine" id="cb184-3" data-line-number="3">red_cell_format_id &lt;-</a>
<a class="sourceLine" id="cb184-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-notes"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">==</span><span class="st"> </span><span class="dv">5</span>, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb184-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(local_format_id)</a>
<a class="sourceLine" id="cb184-7" data-line-number="7">red_cell_format_id</a></code></pre></div>
<pre><code>## [1] 34</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1">red_rgb &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>color<span class="op">$</span>rgb[red_cell_format_id]</a>
<a class="sourceLine" id="cb186-2" data-line-number="2">red &lt;-<span class="st"> </span><span class="kw">which</span>(formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>color<span class="op">$</span>rgb <span class="op">==</span><span class="st"> </span>red_rgb)</a>
<a class="sourceLine" id="cb186-3" data-line-number="3">red</a></code></pre></div>
<pre><code>## [1]  4 10 11 18 34</code></pre>
<p>Now we select the headers, filtering out cells with the format IDs of red or italic cells.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb188-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-notes"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character, numeric, local_format_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 31 x 5
##      row   col character  numeric local_format_id
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;           &lt;int&gt;
##  1     2     4 Female         NA               26
##  2     2     6 Male           NA               26
##  3     2     7 0 = absent     NA               23
##  4     3     4 Matilda        NA               28
##  5     3     5 Olivia         NA               29
##  6     3     6 Nicholas       NA               28
##  7     3     7 Paul           NA               29
##  8     4     2 Humanities     NA               26
##  9     4     3 Classics       NA               27
## 10     4     4 &lt;NA&gt;            1.              22
## # ... with 21 more rows</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">first_header_row &lt;-</a>
<a class="sourceLine" id="cb190-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="op">!</span>(local_format_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(red, italic))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">sex =</span> character)</a>
<a class="sourceLine" id="cb190-4" data-line-number="4">  <span class="co"># the title of this header is 'sex'</span></a>
<a class="sourceLine" id="cb190-5" data-line-number="5">  <span class="co"># the cells are text cells (`"Female"` and `"Male"`) so take the value in the</span></a>
<a class="sourceLine" id="cb190-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb190-7" data-line-number="7">first_header_row</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col sex   
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
## 1     2     4 Female
## 2     2     6 Male</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1">first_header_col &lt;-</a>
<a class="sourceLine" id="cb192-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, <span class="op">!</span>(local_format_id <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(red, italic))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">qualification =</span> character)</a>
<a class="sourceLine" id="cb192-4" data-line-number="4">  <span class="co"># the title of this header is 'field', meaning 'group of subjects'.</span></a>
<a class="sourceLine" id="cb192-5" data-line-number="5">  <span class="co"># The cells are text cells (`"Humanities"`, `"Performance"`) so take the value</span></a>
<a class="sourceLine" id="cb192-6" data-line-number="6">  <span class="co"># in the '`character` column.</span></a>
<a class="sourceLine" id="cb192-7" data-line-number="7">first_header_col</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col qualification
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;        
## 1     4     2 Humanities   
## 2     6     2 Performance</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1">second_header_col &lt;-</a>
<a class="sourceLine" id="cb194-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">subject =</span> character)</a>
<a class="sourceLine" id="cb194-4" data-line-number="4">  <span class="co"># The title of this header is 'subject'</span></a>
<a class="sourceLine" id="cb194-5" data-line-number="5">  <span class="co"># The cells are text cells (`"history"`, etc.) so take the value in the</span></a>
<a class="sourceLine" id="cb194-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb194-7" data-line-number="7"></a>
<a class="sourceLine" id="cb194-8" data-line-number="8">data_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">NNW</a></span>(first_header_row) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">WNW</a></span>(first_header_col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##    score sex    qualification
##    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;        
##  1    1. Female Humanities   
##  2    2. Female Humanities   
##  3    3. Male   Humanities   
##  4    0. Male   Humanities   
##  5    3. Female Humanities   
##  6    4. Female Humanities   
##  7    5. Male   Humanities   
##  8    1. Male   Humanities   
##  9    5. Female Performance  
## 10    6. Female Performance  
## 11    9. Male   Performance  
## 12    2. Male   Performance  
## 13    7. Female Performance  
## 14    8. Female Performance  
## 15   12. Male   Performance  
## 16    3. Male   Performance</code></pre>
</div>
<div id="mixed-levels-of-headers-in-the-same-rowcolumn-distinguished-by-formatting" class="section level3">
<h3 class="hasAnchor">
<a href="#mixed-levels-of-headers-in-the-same-rowcolumn-distinguished-by-formatting" class="anchor"></a>Mixed levels of headers in the same row/column, distinguished by formatting</h3>
<p>Normally different levels of headers are in different rows, or different columns, like “Two clear rows of text column headers, left-aligned”. But sometimes they coexist in the same row or column, and are distinguishable by formatting, e.g. bold for the top level, italic for the mid level, and plain for the lowest level.</p>
<p>In this example, there is a single column of row headers, where the levels are shown by different amounts of indentation. The indentation is done by formatting, rather than by leading spaces or tabs.</p>
<p>The first step is to find the format IDs of all the different levels of indentation.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1">formats &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)</a>
<a class="sourceLine" id="cb196-2" data-line-number="2"></a>
<a class="sourceLine" id="cb196-3" data-line-number="3">indent0 &lt;-<span class="st"> </span><span class="kw">which</span>(formats<span class="op">$</span>local<span class="op">$</span>alignment<span class="op">$</span>indent <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb196-4" data-line-number="4">indent1 &lt;-<span class="st"> </span><span class="kw">which</span>(formats<span class="op">$</span>local<span class="op">$</span>alignment<span class="op">$</span>indent <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb196-5" data-line-number="5"></a>
<a class="sourceLine" id="cb196-6" data-line-number="6">indent0</a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
## [24] 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 42 43 44 45 46 47 48
## [47] 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1">indent1</a></code></pre></div>
<pre><code>## [1] 40 41</code></pre>
<p>Now we use these format IDs to indentify the different levels of headers in the first column.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb200-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-hierarchy"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, local_format_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb200-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 16 x 6
##      row   col data_type character   numeric local_format_id
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;         &lt;dbl&gt;           &lt;int&gt;
##  1     2     3 character Matilda         NA               39
##  2     2     4 character Nicholas        NA               42
##  3     3     2 character Humanities      NA               39
##  4     4     2 character Classics        NA               40
##  5     4     3 numeric   &lt;NA&gt;             1.              28
##  6     4     4 numeric   &lt;NA&gt;             3.              37
##  7     5     2 character History         NA               40
##  8     5     3 numeric   &lt;NA&gt;             3.              28
##  9     5     4 numeric   &lt;NA&gt;             5.              37
## 10     6     2 character Performance     NA               35
## 11     7     2 character Music           NA               40
## 12     7     3 numeric   &lt;NA&gt;             5.              28
## 13     7     4 numeric   &lt;NA&gt;             9.              37
## 14     8     2 character Drama           NA               41
## 15     8     3 numeric   &lt;NA&gt;             7.              30
## 16     8     4 numeric   &lt;NA&gt;            12.              38</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1">field &lt;-</a>
<a class="sourceLine" id="cb202-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, local_format_id <span class="op">%in%</span><span class="st"> </span>indent0) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb202-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">field =</span> character)</a>
<a class="sourceLine" id="cb202-4" data-line-number="4">  <span class="co"># the title of this header is 'field', meaning 'group of subjects'.</span></a>
<a class="sourceLine" id="cb202-5" data-line-number="5">  <span class="co"># The cells are text cells (`"Humanities"`, `"Performance"`) so take the value</span></a>
<a class="sourceLine" id="cb202-6" data-line-number="6">  <span class="co"># in the '`character` column.</span></a>
<a class="sourceLine" id="cb202-7" data-line-number="7">field</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col field      
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;      
## 1     3     2 Humanities 
## 2     6     2 Performance</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">subject &lt;-</a>
<a class="sourceLine" id="cb204-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>, local_format_id <span class="op">%in%</span><span class="st"> </span>indent1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb204-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">subject =</span> character)</a>
<a class="sourceLine" id="cb204-4" data-line-number="4">  <span class="co"># The title of this header is 'subject'</span></a>
<a class="sourceLine" id="cb204-5" data-line-number="5">  <span class="co"># The cells are text cells (`"history"`, etc.) so take the value in the</span></a>
<a class="sourceLine" id="cb204-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb204-7" data-line-number="7">subject</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col subject 
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     4     2 Classics
## 2     5     2 History 
## 3     7     2 Music   
## 4     8     2 Drama</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">name &lt;-</a>
<a class="sourceLine" id="cb206-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb206-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">name =</span> character)</a>
<a class="sourceLine" id="cb206-4" data-line-number="4">  <span class="co"># The title of this header is 'name'.</span></a>
<a class="sourceLine" id="cb206-5" data-line-number="5">  <span class="co"># The cells are text cells, so take the value in the '`character` column.</span></a>
<a class="sourceLine" id="cb206-6" data-line-number="6">name</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col name    
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     2     3 Matilda 
## 2     2     4 Nicholas</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1">data_cells &lt;-</a>
<a class="sourceLine" id="cb208-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">score =</span> numeric)</a>
<a class="sourceLine" id="cb208-4" data-line-number="4">  <span class="co"># The data is exam scores in certain subjects, so give the data that title.</span></a>
<a class="sourceLine" id="cb208-5" data-line-number="5">  <span class="co"># The data is numeric, so select only that 'value'.  If some of the data was</span></a>
<a class="sourceLine" id="cb208-6" data-line-number="6">  <span class="co"># also text or true/false, then you would select the `character` and `logical`</span></a>
<a class="sourceLine" id="cb208-7" data-line-number="7">  <span class="co"># columns as well as `numeric`</span></a>
<a class="sourceLine" id="cb208-8" data-line-number="8"></a>
<a class="sourceLine" id="cb208-9" data-line-number="9">data_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">WNW</a></span>(field) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">W</a></span>(subject) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">N</a></span>(name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb208-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   score field       subject  name    
##   &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;   
## 1    1. Humanities  Classics Matilda 
## 2    3. Humanities  Classics Nicholas
## 3    3. Humanities  History  Matilda 
## 4    5. Humanities  History  Nicholas
## 5    5. Performance Music    Matilda 
## 6    9. Performance Music    Nicholas
## 7    7. Performance Drama    Matilda 
## 8   12. Performance Drama    Nicholas</code></pre>
</div>
<div id="repeated-rowscolumns-of-headers-within-the-table" class="section level3">
<h3 class="hasAnchor">
<a href="#repeated-rowscolumns-of-headers-within-the-table" class="anchor"></a>Repeated rows/columns of headers within the table</h3>
<p>TODO: Image</p>
<p>Repetitions can simply be ignored. Select one of the sets of headers, and use it for all the data. In this example, the data cells are easy to distinguish from the headers mixed in among them, because only the data cells have the <code>numeric</code> data type.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb210-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-repeated-headers"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 80 x 5
##      row   col data_type character numeric
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
##  1     2     4 character Term 1        NA 
##  2     2     5 character Term 2        NA 
##  3     2     6 character Term 3        NA 
##  4     3     2 character Classics      NA 
##  5     3     3 character Matilda       NA 
##  6     3     4 numeric   &lt;NA&gt;           4.
##  7     3     5 numeric   &lt;NA&gt;           9.
##  8     3     6 numeric   &lt;NA&gt;           1.
##  9     4     3 character Nicholas      NA 
## 10     4     4 numeric   &lt;NA&gt;           0.
## # ... with 70 more rows</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1"><span class="co"># View the cells in their original positions on the spreadsheet</span></a>
<a class="sourceLine" id="cb212-2" data-line-number="2"><span class="kw"><a href="../reference/rectify.html">rectify</a></span>(all_cells)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 6
##    `row/col` `2(B)`   `3(C)`   `4(D)` `5(E)` `6(F)`
##        &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt; 
##  1         2 &lt;NA&gt;     &lt;NA&gt;     Term 1 Term 2 Term 3
##  2         3 Classics Matilda  4      9      1     
##  3         4 &lt;NA&gt;     Nicholas 0      7      3     
##  4         5 &lt;NA&gt;     Olivia   9      0      4     
##  5         6 &lt;NA&gt;     Paul     0      0      6     
##  6         7 &lt;NA&gt;     &lt;NA&gt;     Term 1 Term 2 Term 3
##  7         8 History  Matilda  5      5      1     
##  8         9 &lt;NA&gt;     Nicholas 1      2      8     
##  9        10 &lt;NA&gt;     Olivia   7      0      8     
## 10        11 &lt;NA&gt;     Paul     1      6      8     
## 11        12 &lt;NA&gt;     &lt;NA&gt;     Term 1 Term 2 Term 3
## 12        13 Music    Matilda  0      5      7     
## 13        14 &lt;NA&gt;     Nicholas 9      9      7     
## 14        15 &lt;NA&gt;     Olivia   3      0      1     
## 15        16 &lt;NA&gt;     Paul     5      7      7     
## 16        17 &lt;NA&gt;     &lt;NA&gt;     Term 1 Term 2 Term 3
## 17        18 Drama    Matilda  0      0      0     
## 18        19 &lt;NA&gt;     Nicholas 8      5      6     
## 19        20 &lt;NA&gt;     Olivia   6      1      8     
## 20        21 &lt;NA&gt;     Paul     4      6      5</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1"><span class="co"># The 'term' headers appear four times, but only the first one is needed.</span></a>
<a class="sourceLine" id="cb214-2" data-line-number="2">term &lt;-</a>
<a class="sourceLine" id="cb214-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb214-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">term =</span> character)</a>
<a class="sourceLine" id="cb214-5" data-line-number="5">  <span class="co"># the title of this header is 'field', meaning 'group of subjects'.</span></a>
<a class="sourceLine" id="cb214-6" data-line-number="6">  <span class="co"># The cells are text cells (`"Humanities"`, `"Performance"`) so take the value</span></a>
<a class="sourceLine" id="cb214-7" data-line-number="7">  <span class="co"># in the '`character` column.</span></a>
<a class="sourceLine" id="cb214-8" data-line-number="8">term</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##     row   col term  
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
## 1     2     4 Term 1
## 2     2     5 Term 2
## 3     2     6 Term 3</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" data-line-number="1">subject &lt;-</a>
<a class="sourceLine" id="cb216-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">subject =</span> character)</a>
<a class="sourceLine" id="cb216-4" data-line-number="4">  <span class="co"># The title of this header is 'subject'</span></a>
<a class="sourceLine" id="cb216-5" data-line-number="5">  <span class="co"># The cells are text cells (`"history"`, etc.) so take the value in the</span></a>
<a class="sourceLine" id="cb216-6" data-line-number="6">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb216-7" data-line-number="7">subject</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col subject 
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     3     2 Classics
## 2     8     2 History 
## 3    13     2 Music   
## 4    18     2 Drama</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" data-line-number="1">name &lt;-</a>
<a class="sourceLine" id="cb218-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb218-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">name =</span> character)</a>
<a class="sourceLine" id="cb218-4" data-line-number="4">  <span class="co"># The title of this header is 'name'.</span></a>
<a class="sourceLine" id="cb218-5" data-line-number="5">  <span class="co"># The cells are text cells, so take the value in the '`character` column.</span></a>
<a class="sourceLine" id="cb218-6" data-line-number="6">name</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##      row   col name    
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
##  1     3     3 Matilda 
##  2     4     3 Nicholas
##  3     5     3 Olivia  
##  4     6     3 Paul    
##  5     8     3 Matilda 
##  6     9     3 Nicholas
##  7    10     3 Olivia  
##  8    11     3 Paul    
##  9    13     3 Matilda 
## 10    14     3 Nicholas
## 11    15     3 Olivia  
## 12    16     3 Paul    
## 13    18     3 Matilda 
## 14    19     3 Nicholas
## 15    20     3 Olivia  
## 16    21     3 Paul</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1"><span class="co"># The data cells are distinguished from the 'term' headers by their data type --</span></a>
<a class="sourceLine" id="cb220-2" data-line-number="2"><span class="co"># the data cells are numeric, whereas the term headers are character.</span></a>
<a class="sourceLine" id="cb220-3" data-line-number="3">data_cells &lt;-</a>
<a class="sourceLine" id="cb220-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb220-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">score =</span> numeric)</a>
<a class="sourceLine" id="cb220-6" data-line-number="6">  <span class="co"># The data is exam scores in certain subjects, so give the data that title.</span></a>
<a class="sourceLine" id="cb220-7" data-line-number="7">  <span class="co"># The data is numeric, so select only that 'value'.  If some of the data was</span></a>
<a class="sourceLine" id="cb220-8" data-line-number="8">  <span class="co"># also text or true/false, then you would select the `character` and `logical`</span></a>
<a class="sourceLine" id="cb220-9" data-line-number="9">  <span class="co"># columns as well as `numeric`</span></a>
<a class="sourceLine" id="cb220-10" data-line-number="10">data_cells</a></code></pre></div>
<pre><code>## # A tibble: 48 x 3
##      row   col score
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     3     4    4.
##  2     3     5    9.
##  3     3     6    1.
##  4     4     4    0.
##  5     4     5    7.
##  6     4     6    3.
##  7     5     4    9.
##  8     5     5    0.
##  9     5     6    4.
## 10     6     4    0.
## # ... with 38 more rows</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1">data_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">N</a></span>(term) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">NNW</a></span>(subject) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">W</a></span>(name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 48 x 4
##    score term   subject name    
##    &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   
##  1    4. Term 1 Drama   Matilda 
##  2    9. Term 2 Drama   Matilda 
##  3    1. Term 3 Drama   Matilda 
##  4    0. Term 1 Drama   Nicholas
##  5    7. Term 2 Drama   Nicholas
##  6    3. Term 3 Drama   Nicholas
##  7    9. Term 1 Drama   Olivia  
##  8    0. Term 2 Drama   Olivia  
##  9    4. Term 3 Drama   Olivia  
## 10    0. Term 1 Drama   Paul    
## # ... with 38 more rows</code></pre>
</div>
<div id="headers-amongst-the-data" class="section level3">
<h3 class="hasAnchor">
<a href="#headers-amongst-the-data" class="anchor"></a>Headers amongst the data</h3>
<p>This happens when what is actually a row-header, instead of being presented to the left of the data, is presented above the data. (Alternatively, what is actually a column header, instead of being presented above the data, is presented to the side.)</p>
<p>The way to handle it is to <em>pretend</em> that it is a row header, and use the <code><a href="../reference/join_header.html">WNW()</a></code> direction as normal. Note that <code><a href="../reference/join_header.html">NNW()</a></code> is not a synonym in this case – try it and see what happens.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb224-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"pivot-header-within-data"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, local_format_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-5" data-line-number="5"><span class="st">  </span><span class="kw">print</span>()</a></code></pre></div>
<pre><code>## # A tibble: 80 x 6
##      row   col data_type character numeric local_format_id
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;           &lt;int&gt;
##  1     2     3 character Classics      NA               59
##  2     3     3 character Term 1        NA               28
##  3     3     4 character Term 2        NA               44
##  4     3     5 character Term 3        NA               29
##  5     4     2 character Matilda       NA               26
##  6     4     3 numeric   &lt;NA&gt;           8.              26
##  7     4     4 numeric   &lt;NA&gt;           7.              48
##  8     4     5 numeric   &lt;NA&gt;           1.              27
##  9     5     2 character Nicholas      NA               28
## 10     5     3 numeric   &lt;NA&gt;           2.              28
## # ... with 70 more rows</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1"><span class="co"># View the cells in their original positions on the spreadsheet</span></a>
<a class="sourceLine" id="cb226-2" data-line-number="2"><span class="kw"><a href="../reference/rectify.html">rectify</a></span>(all_cells)</a></code></pre></div>
<pre><code>## # A tibble: 24 x 5
##    `row/col` `2(B)`   `3(C)`   `4(D)` `5(E)`
##        &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; 
##  1         2 &lt;NA&gt;     Classics &lt;NA&gt;   &lt;NA&gt;  
##  2         3 &lt;NA&gt;     Term 1   Term 2 Term 3
##  3         4 Matilda  8        7      1     
##  4         5 Nicholas 2        5      1     
##  5         6 Olivia   0        8      8     
##  6         7 Paul     5        5      4     
##  7         8 &lt;NA&gt;     History  &lt;NA&gt;   &lt;NA&gt;  
##  8         9 &lt;NA&gt;     Term 1   Term 2 Term 3
##  9        10 Matilda  2        3      9     
## 10        11 Nicholas 2        4      3     
## # ... with 14 more rows</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">bold &lt;-<span class="st"> </span><span class="kw">which</span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold)</a>
<a class="sourceLine" id="cb228-2" data-line-number="2"></a>
<a class="sourceLine" id="cb228-3" data-line-number="3"><span class="co"># The subject headers, though mixed with the data and the 'term' headers, are</span></a>
<a class="sourceLine" id="cb228-4" data-line-number="4"><span class="co"># distinguishable by the data type "character" and by being bold.</span></a>
<a class="sourceLine" id="cb228-5" data-line-number="5">subject &lt;-</a>
<a class="sourceLine" id="cb228-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells,</a>
<a class="sourceLine" id="cb228-7" data-line-number="7">         col <span class="op">==</span><span class="st"> </span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb228-8" data-line-number="8">         data_type <span class="op">==</span><span class="st"> "character"</span>,</a>
<a class="sourceLine" id="cb228-9" data-line-number="9">         local_format_id <span class="op">%in%</span><span class="st"> </span>bold) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">subject =</span> character)</a>
<a class="sourceLine" id="cb228-11" data-line-number="11">  <span class="co"># The title of this header is 'subject'</span></a>
<a class="sourceLine" id="cb228-12" data-line-number="12">  <span class="co"># The cells are text cells (`"history"`, etc.) so take the value in the</span></a>
<a class="sourceLine" id="cb228-13" data-line-number="13">  <span class="co"># '`character` column.</span></a>
<a class="sourceLine" id="cb228-14" data-line-number="14">subject</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     row   col subject 
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
## 1     2     3 Classics
## 2     8     3 History 
## 3    14     3 Music   
## 4    20     3 Drama</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1"><span class="co"># We only need one set of the 'term' headers</span></a>
<a class="sourceLine" id="cb230-2" data-line-number="2">term &lt;-</a>
<a class="sourceLine" id="cb230-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">==</span><span class="st"> </span><span class="dv">3</span>, data_type <span class="op">==</span><span class="st"> "character"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">term =</span> character)</a>
<a class="sourceLine" id="cb230-5" data-line-number="5">  <span class="co"># the title of this header is 'field', meaning 'group of subjects'.</span></a>
<a class="sourceLine" id="cb230-6" data-line-number="6">  <span class="co"># The cells are text cells (`"Humanities"`, `"Performance"`) so take the value</span></a>
<a class="sourceLine" id="cb230-7" data-line-number="7">  <span class="co"># in the '`character` column.</span></a>
<a class="sourceLine" id="cb230-8" data-line-number="8">term</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##     row   col term  
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt; 
## 1     3     3 Term 1
## 2     3     4 Term 2
## 3     3     5 Term 3</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1">name &lt;-</a>
<a class="sourceLine" id="cb232-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, col <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">name =</span> character)</a>
<a class="sourceLine" id="cb232-4" data-line-number="4">  <span class="co"># The title of this header is 'name'.</span></a>
<a class="sourceLine" id="cb232-5" data-line-number="5">  <span class="co"># The cells are text cells, so take the value in the '`character` column.</span></a>
<a class="sourceLine" id="cb232-6" data-line-number="6">name</a></code></pre></div>
<pre><code>## # A tibble: 16 x 3
##      row   col name    
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;   
##  1     4     2 Matilda 
##  2     5     2 Nicholas
##  3     6     2 Olivia  
##  4     7     2 Paul    
##  5    10     2 Matilda 
##  6    11     2 Nicholas
##  7    12     2 Olivia  
##  8    13     2 Paul    
##  9    16     2 Matilda 
## 10    17     2 Nicholas
## 11    18     2 Olivia  
## 12    19     2 Paul    
## 13    22     2 Matilda 
## 14    23     2 Nicholas
## 15    24     2 Olivia  
## 16    25     2 Paul</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1"><span class="co"># The data cells are distinguished from the 'subject' headers by their data</span></a>
<a class="sourceLine" id="cb234-2" data-line-number="2"><span class="co"># type -- the data cells are numeric, whereas the term headers are character.</span></a>
<a class="sourceLine" id="cb234-3" data-line-number="3">data_cells &lt;-</a>
<a class="sourceLine" id="cb234-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, data_type <span class="op">==</span><span class="st"> "numeric"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, <span class="dt">score =</span> numeric)</a>
<a class="sourceLine" id="cb234-6" data-line-number="6">  <span class="co"># The data is exam scores in certain subjects, so give the data that title.</span></a>
<a class="sourceLine" id="cb234-7" data-line-number="7">  <span class="co"># The data is numeric, so select only that 'value'.  If some of the data was</span></a>
<a class="sourceLine" id="cb234-8" data-line-number="8">  <span class="co"># also text or true/false, then you would select the `character` and `logical`</span></a>
<a class="sourceLine" id="cb234-9" data-line-number="9">  <span class="co"># columns as well as `numeric`</span></a>
<a class="sourceLine" id="cb234-10" data-line-number="10">data_cells</a></code></pre></div>
<pre><code>## # A tibble: 48 x 3
##      row   col score
##    &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1     4     3    8.
##  2     4     4    7.
##  3     4     5    1.
##  4     5     3    2.
##  5     5     4    5.
##  6     5     5    1.
##  7     6     3    0.
##  8     6     4    8.
##  9     6     5    8.
## 10     7     3    5.
## # ... with 38 more rows</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1">data_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">WNW</a></span>(subject) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">N</a></span>(term) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/join_header.html">W</a></span>(name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb236-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row, <span class="op">-</span>col)</a></code></pre></div>
<pre><code>## # A tibble: 48 x 4
##    score subject  term   name    
##    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;   
##  1    8. Classics Term 1 Matilda 
##  2    7. Classics Term 2 Matilda 
##  3    1. Classics Term 3 Matilda 
##  4    2. Classics Term 1 Nicholas
##  5    5. Classics Term 2 Nicholas
##  6    1. Classics Term 3 Nicholas
##  7    0. Classics Term 1 Olivia  
##  8    8. Classics Term 2 Olivia  
##  9    8. Classics Term 3 Olivia  
## 10    5. Classics Term 1 Paul    
## # ... with 38 more rows</code></pre>
</div>
</div>
<div id="small-multiples" class="section level2">
<h2 class="hasAnchor">
<a href="#small-multiples" class="anchor"></a>Small multiples</h2>
<p>You might have heard the term ‘small multiples’ in the context of graphs, but it also occurs in spreadsheets, when an array of small tables could be combined into a single table.</p>
<p>TODO: Image</p>
<p>To import an array of small tables, start by writing the code to import one, and then apply that to each in turn.</p>
<ol style="list-style-type: decimal">
<li>Write the code to import one table.</li>
<li>Wrap that code in a function.</li>
<li>Partition the whole spreadsheet so that each table is in one partition.</li>
<li>Map the function over the partitions.</li>
</ol>
<div id="small-multiples-with-all-headers-present-for-each-multiple" class="section level3">
<h3 class="hasAnchor">
<a href="#small-multiples-with-all-headers-present-for-each-multiple" class="anchor"></a>Small multiples with all headers present for each multiple</h3>
<p>TODO: Image</p>
<p>The code to import one of these multiples will be simple.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1"><span class="co"># cells %&gt;%</span></a>
<a class="sourceLine" id="cb238-2" data-line-number="2"><span class="co">#   behead(NNW, subject) %&gt;%</span></a>
<a class="sourceLine" id="cb238-3" data-line-number="3"><span class="co">#   behead(N, header) %&gt;%</span></a>
<a class="sourceLine" id="cb238-4" data-line-number="4"><span class="co">#   select(-col, - local_format_id) %&gt;%</span></a>
<a class="sourceLine" id="cb238-5" data-line-number="5"><span class="co">#   spatter(header) %&gt;%</span></a>
<a class="sourceLine" id="cb238-6" data-line-number="6"><span class="co">#   select(-row)</span></a></code></pre></div>
<p>The first table is in rows 1 to 4, columns 1 to 3, so we start by writing the code to import only that table.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb239-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="st">"small-multiples"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, local_format_id)</a>
<a class="sourceLine" id="cb239-5" data-line-number="5"></a>
<a class="sourceLine" id="cb239-6" data-line-number="6">table1 &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, row <span class="op">%in%</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, col <span class="op">%in%</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb239-7" data-line-number="7"></a>
<a class="sourceLine" id="cb239-8" data-line-number="8">table1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(NNW, subject) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col, <span class="op">-</span><span class="st"> </span>local_format_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb239-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   subject  Grade Name    Score
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1 Classics F     Matilda    1.
## 2 Classics D     Olivia     2.</code></pre>
<p>We wrap that code in a function, to be applied to each separate table.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">unpivot &lt;-<span class="st"> </span><span class="cf">function</span>(cells) {</a>
<a class="sourceLine" id="cb241-2" data-line-number="2">  cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb241-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(NNW, subject) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb241-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb241-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col, <span class="op">-</span><span class="st"> </span>local_format_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb241-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb241-7" data-line-number="7"><span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a>
<a class="sourceLine" id="cb241-8" data-line-number="8">}</a></code></pre></div>
<p>Now we partition the spreadsheet into the separate tables. This is done by identifying a corner cell in each table.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" data-line-number="1">formats &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)</a>
<a class="sourceLine" id="cb242-2" data-line-number="2">italic &lt;-<span class="st"> </span><span class="kw">which</span>(formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>italic)</a>
<a class="sourceLine" id="cb242-3" data-line-number="3"></a>
<a class="sourceLine" id="cb242-4" data-line-number="4">corners &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(all_cells, local_format_id <span class="op">%in%</span><span class="st"> </span>italic)</a>
<a class="sourceLine" id="cb242-5" data-line-number="5">partitions &lt;-<span class="st"> </span><span class="kw"><a href="../reference/partition.html">partition</a></span>(all_cells, corners)</a>
<a class="sourceLine" id="cb242-6" data-line-number="6">partitions</a></code></pre></div>
<pre><code>## # A tibble: 40 x 7
##      row   col data_type character numeric local_format_id partition
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;           &lt;int&gt;     &lt;int&gt;
##  1     1     1 character Classics      NA                2         1
##  2     1     5 character History       NA                2         2
##  3     2     1 character Name          NA                6         1
##  4     2     2 character Score         NA                6         1
##  5     2     3 character Grade         NA                6         1
##  6     2     5 character Name          NA                6         2
##  7     2     6 character Score         NA                6         2
##  8     2     7 character Grade         NA                6         2
##  9     3     1 character Matilda       NA                1         1
## 10     3     2 numeric   &lt;NA&gt;           1.               1         1
## # ... with 30 more rows</code></pre>
<p>Finally, map the unpivoting function over the partitions, and combine the results.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" data-line-number="1">partitions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/nest">nest</a></span>(<span class="op">-</span>partition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map</a></span>(unpivot) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb244-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   subject  Grade Name    Score
##   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1 Classics F     Matilda    1.
## 2 Classics D     Olivia     2.
## 3 History  D     Matilda    3.
## 4 History  C     Olivia     4.
## 5 Music    B     Matilda    5.
## 6 Music    B     Olivia     6.
## 7 Drama    A     Matilda    7.
## 8 Drama    A     Olivia     8.</code></pre>
</div>
<div id="same-table-in-several-worksheetsfiles-using-the-sheetfile-name" class="section level3">
<h3 class="hasAnchor">
<a href="#same-table-in-several-worksheetsfiles-using-the-sheetfile-name" class="anchor"></a>Same table in several worksheets/files (using the sheet/file name)</h3>
<p>Because <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/tidyxl">tidyxl()</a></code> imports cells from multiple sheets into the same data frame, tables on separate sheets can be imported by mapping over the different sheets. Just name each sheet in the <code>xlsx_cell()</code> call, or don’t name any to import them all.</p>
<p>As far as <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/tidyxl">tidyxl()</a></code> is concerned, the particular sheet (aka ‘tab’) that a cell is on is another coordinate like <code>row</code> and <code>col</code>, so the full location of a cell is its <code>row</code>, its <code>col</code>, and its <code>sheet</code>.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb246-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="kw">c</span>(<span class="st">"humanities"</span>, <span class="st">"performance"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb246-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb246-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(sheet, row, col, data_type, character, numeric)</a>
<a class="sourceLine" id="cb246-5" data-line-number="5">all_cells</a></code></pre></div>
<pre><code>## # A tibble: 16 x 6
##    sheet         row   col data_type character numeric
##    &lt;chr&gt;       &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt;
##  1 humanities      1     2 character Matilda       NA 
##  2 humanities      1     3 character Nicholas      NA 
##  3 humanities      2     1 character Classics      NA 
##  4 humanities      2     2 numeric   &lt;NA&gt;           1.
##  5 humanities      2     3 numeric   &lt;NA&gt;           3.
##  6 humanities      3     1 character History       NA 
##  7 humanities      3     2 numeric   &lt;NA&gt;           3.
##  8 humanities      3     3 numeric   &lt;NA&gt;           5.
##  9 performance     1     2 character Matilda       NA 
## 10 performance     1     3 character Nicholas      NA 
## 11 performance     2     1 character Music         NA 
## 12 performance     2     2 numeric   &lt;NA&gt;           5.
## 13 performance     2     3 numeric   &lt;NA&gt;           9.
## 14 performance     3     1 character Drama         NA 
## 15 performance     3     2 numeric   &lt;NA&gt;           7.
## 16 performance     3     3 numeric   &lt;NA&gt;          12.</code></pre>
<p>To prepare the sheets to be mapped over, use <code><a href="http://www.rdocumentation.org/packages/tidyr/topics/nest">tidyr::nest()</a></code>. The <code>data</code> column contains the cells of each sheet.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" data-line-number="1">all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb248-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/nest">nest</a></span>(<span class="op">-</span>sheet)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   sheet       data            
##   &lt;chr&gt;       &lt;list&gt;          
## 1 humanities  &lt;tibble [8 × 5]&gt;
## 2 performance &lt;tibble [8 × 5]&gt;</code></pre>
<p>The function to unpivot each table in this case will be a couple of <code><a href="../reference/behead.html">behead()</a></code> statements. Further clean-up can be saved until the end.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" data-line-number="1">unpivot &lt;-<span class="st"> </span><span class="cf">function</span>(cells) {</a>
<a class="sourceLine" id="cb250-2" data-line-number="2">  cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb250-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, subject)</a>
<a class="sourceLine" id="cb250-5" data-line-number="5">}</a></code></pre></div>
<p>After mapping the unpivot function over each sheet of cells, use <code><a href="http://www.rdocumentation.org/packages/tidyr/topics/unnest">tidyr::unnest()</a></code> to show every row of data again.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1">all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb251-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/nest">nest</a></span>(<span class="op">-</span>sheet) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb251-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">data =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map</a></span>(data, unpivot)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb251-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/unnest">unnest</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 8 x 8
##   sheet         row   col data_type character numeric name     subject 
##   &lt;chr&gt;       &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;   
## 1 humanities      2     2 numeric   &lt;NA&gt;           1. Matilda  Classics
## 2 humanities      2     3 numeric   &lt;NA&gt;           3. Nicholas Classics
## 3 humanities      3     2 numeric   &lt;NA&gt;           3. Matilda  History 
## 4 humanities      3     3 numeric   &lt;NA&gt;           5. Nicholas History 
## 5 performance     2     2 numeric   &lt;NA&gt;           5. Matilda  Music   
## 6 performance     2     3 numeric   &lt;NA&gt;           9. Nicholas Music   
## 7 performance     3     2 numeric   &lt;NA&gt;           7. Matilda  Drama   
## 8 performance     3     3 numeric   &lt;NA&gt;          12. Nicholas Drama</code></pre>
<p>Finally, do the clean-up operations that were saved until now.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1">all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/nest">nest</a></span>(<span class="op">-</span>sheet) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">data =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map</a></span>(data, unpivot)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/unnest">unnest</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb253-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">transmute</a></span>(<span class="dt">field =</span> sheet,</a>
<a class="sourceLine" id="cb253-6" data-line-number="6">            name,</a>
<a class="sourceLine" id="cb253-7" data-line-number="7">            subject,</a>
<a class="sourceLine" id="cb253-8" data-line-number="8">            <span class="dt">score =</span> numeric)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   field       name     subject  score
##   &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;
## 1 humanities  Matilda  Classics    1.
## 2 humanities  Nicholas Classics    3.
## 3 humanities  Matilda  History     3.
## 4 humanities  Nicholas History     5.
## 5 performance Matilda  Music       5.
## 6 performance Nicholas Music       9.
## 7 performance Matilda  Drama       7.
## 8 performance Nicholas Drama      12.</code></pre>
</div>
<div id="same-table-in-several-worksheetsfiles-but-in-different-positions" class="section level3">
<h3 class="hasAnchor">
<a href="#same-table-in-several-worksheetsfiles-but-in-different-positions" class="anchor"></a>Same table in several worksheets/files but in different positions</h3>
<p>This is almost the same as the section “Same table in several worksheets/files (using the sheet/file name)”. The only difference is that the function you write to unpivot the table must also <em>find</em> the table in the first place, and be robust to differences in the placement and context of the table on each sheet.</p>
<p>In this example, both tables begin in the same column, but there is an extra row of notes above one of the tables. There are a few ways to tackle this problem. Here, we will begin at an anchor cell, <code>A1</code>, move down until we reach the <code>Subject</code> cell, which is either <code>A3</code> or <code>A4</code>, and then extend the selection to include the whole table.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1">all_cells &lt;-</a>
<a class="sourceLine" id="cb255-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheets =</span> <span class="kw">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb255-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="op">!</span>is_blank) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb255-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(sheet, row, col, data_type, character, numeric)</a>
<a class="sourceLine" id="cb255-5" data-line-number="5">all_cells</a></code></pre></div>
<pre><code>## # A tibble: 21 x 6
##    sheet    row   col data_type character       numeric
##    &lt;chr&gt;  &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;
##  1 female     1     1 character Table of scores     NA 
##  2 female     3     1 character Subject             NA 
##  3 female     3     2 character Matilda             NA 
##  4 female     3     3 character Olivia              NA 
##  5 female     4     1 character Classics            NA 
##  6 female     4     2 numeric   &lt;NA&gt;                 1.
##  7 female     4     3 numeric   &lt;NA&gt;                 2.
##  8 female     5     1 character History             NA 
##  9 female     5     2 numeric   &lt;NA&gt;                 3.
## 10 female     5     3 numeric   &lt;NA&gt;                 4.
## # ... with 11 more rows</code></pre>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">unpivot &lt;-<span class="st"> </span><span class="cf">function</span>(cells) {</a>
<a class="sourceLine" id="cb257-2" data-line-number="2">  cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="../reference/anchor.html">anchor</a></span>(1L, 1L) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Cell A1 is in row 1, column 1</span></a>
<a class="sourceLine" id="cb257-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="../reference/offset.html">offset_S</a></span>(cells, <span class="dt">boundary =</span> <span class="op">~</span><span class="st"> </span>character <span class="op">==</span><span class="st"> "Subject"</span>, <span class="dt">include =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/extend.html">extend_S</a></span>(cells, <span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># The table is three cells wide, and three high</span></a>
<a class="sourceLine" id="cb257-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="../reference/extend.html">extend_E</a></span>(cells, <span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-7" data-line-number="7"><span class="st">    </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, subject)</a>
<a class="sourceLine" id="cb257-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb257-10" data-line-number="10"></a>
<a class="sourceLine" id="cb257-11" data-line-number="11">all_cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/nest">nest</a></span>(<span class="op">-</span>sheet) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">data =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map</a></span>(data, unpivot)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/unnest">unnest</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb257-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="dt">sex =</span> sheet, name, subject, <span class="dt">score =</span> numeric)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 4
##   sex    name     subject  score
##   &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt;
## 1 female Matilda  Classics    1.
## 2 female Olivia   Classics    2.
## 3 female Matilda  History     3.
## 4 female Olivia   History     4.
## 5 male   Nicholas Classics    3.
## 6 male   Paul     Classics    0.
## 7 male   Nicholas History     5.
## 8 male   Paul     History     1.</code></pre>
</div>
</div>
<div id="formatting" class="section level2">
<h2 class="hasAnchor">
<a href="#formatting" class="anchor"></a>Formatting</h2>
<p>The formatting of a cell is available via a lookup table. Well, not a lookup table – a lookup list-of-lists.</p>
<ol style="list-style-type: decimal">
<li>Obtain the list of formats that you need</li>
<li>Look up the cell’s <code>style_format</code> or <code>local_format_id</code> in that list</li>
</ol>
<p>This example shows how to look up whether a cell is bold.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">cells &lt;-</a>
<a class="sourceLine" id="cb259-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb259-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character, style_format, local_format_id)</a>
<a class="sourceLine" id="cb259-4" data-line-number="4">cells</a></code></pre></div>
<pre><code>## # A tibble: 14 x 5
##      row   col character          style_format local_format_id
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                  &lt;int&gt;
##  1     1     1 bold               Normal                     3
##  2     2     1 italic             Normal                     2
##  3     3     1 underline          Normal                    50
##  4     4     1 strikethrough      Normal                    51
##  5     5     1 red text           Normal                     4
##  6     6     1 font size 14       Normal                    52
##  7     7     1 font arial         Normal                    53
##  8     8     1 yellow fill        Normal                     5
##  9     9     1 black border       Normal                    36
## 10    10     1 thick border       Normal                    54
## 11    11     1 dashed border      Normal                    55
## 12    12     1 row height 30      Normal                     1
## 13    13     2 column width 16.76 Normal                     1
## 14    14     1 Bad' style         Bad                       56</code></pre>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1">formats &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)</a>
<a class="sourceLine" id="cb261-2" data-line-number="2">bold &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold</a>
<a class="sourceLine" id="cb261-3" data-line-number="3">bold</a></code></pre></div>
<pre><code>##  [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [12] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [23] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [34] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [45] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
## [56] FALSE  TRUE FALSE  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(cells, <span class="dt">bold =</span> bold[local_format_id])</a></code></pre></div>
<pre><code>## # A tibble: 14 x 6
##      row   col character          style_format local_format_id bold 
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                  &lt;int&gt; &lt;lgl&gt;
##  1     1     1 bold               Normal                     3 TRUE 
##  2     2     1 italic             Normal                     2 FALSE
##  3     3     1 underline          Normal                    50 FALSE
##  4     4     1 strikethrough      Normal                    51 FALSE
##  5     5     1 red text           Normal                     4 FALSE
##  6     6     1 font size 14       Normal                    52 FALSE
##  7     7     1 font arial         Normal                    53 FALSE
##  8     8     1 yellow fill        Normal                     5 FALSE
##  9     9     1 black border       Normal                    36 FALSE
## 10    10     1 thick border       Normal                    54 FALSE
## 11    11     1 dashed border      Normal                    55 FALSE
## 12    12     1 row height 30      Normal                     1 FALSE
## 13    13     2 column width 16.76 Normal                     1 FALSE
## 14    14     1 Bad' style         Bad                       56 FALSE</code></pre>
<p>A quick way to see what formatting definitions exist is to use <code>str()</code>. (Scroll past this for now – you don’t need to memorise it).</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1">formats &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)</a>
<a class="sourceLine" id="cb265-2" data-line-number="2"><span class="kw">str</span>(formats)</a></code></pre></div>
<pre><code>## List of 2
##  $ local:List of 6
##   ..$ numFmt    : chr [1:63] "General" "General" "General" "General" ...
##   ..$ font      :List of 10
##   .. ..$ bold     : logi [1:63] FALSE FALSE TRUE FALSE FALSE TRUE ...
##   .. ..$ italic   : logi [1:63] FALSE TRUE FALSE FALSE FALSE FALSE ...
##   .. ..$ underline: chr [1:63] NA NA NA NA ...
##   .. ..$ strike   : logi [1:63] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ vertAlign: chr [1:63] NA NA NA NA ...
##   .. ..$ size     : num [1:63] 11 11 11 11 11 11 11 11 11 11 ...
##   .. ..$ color    :List of 4
##   .. .. ..$ rgb    : chr [1:63] "FF000000" "FF000000" "FF000000" "FFFF0000" ...
##   .. .. ..$ theme  : chr [1:63] "text1" "text1" "text1" NA ...
##   .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ name     : chr [1:63] "Calibri" "Calibri" "Calibri" "Calibri" ...
##   .. ..$ family   : int [1:63] 2 2 2 2 2 2 2 2 2 2 ...
##   .. ..$ scheme   : chr [1:63] "minor" "minor" "minor" "minor" ...
##   ..$ fill      :List of 2
##   .. ..$ patternFill :List of 3
##   .. .. ..$ fgColor    :List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ bgColor    :List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA 65 NA 65 NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ patternType: chr [1:63] NA NA NA NA ...
##   .. ..$ gradientFill:List of 8
##   .. .. ..$ type  : chr [1:63] NA NA NA NA ...
##   .. .. ..$ degree: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ left  : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ right : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ top   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ bottom: num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ stop1 :List of 2
##   .. .. .. ..$ position: num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ color   :List of 4
##   .. .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. ..$ stop2 :List of 2
##   .. .. .. ..$ position: num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ color   :List of 4
##   .. .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   ..$ border    :List of 12
##   .. ..$ diagonalDown: logi [1:63] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ diagonalUp  : logi [1:63] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ outline     : logi [1:63] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ left        :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ right       :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ start       :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ end         :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ top         :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ bottom      :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA 65 NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ diagonal    :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ vertical    :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. ..$ horizontal  :List of 2
##   .. .. ..$ style: chr [1:63] NA NA NA NA ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ theme  : chr [1:63] NA NA NA NA ...
##   .. .. .. ..$ indexed: int [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..$ tint   : num [1:63] NA NA NA NA NA NA NA NA NA NA ...
##   ..$ alignment :List of 8
##   .. ..$ horizontal     : chr [1:63] "general" "general" "general" "general" ...
##   .. ..$ vertical       : chr [1:63] "bottom" "bottom" "bottom" "bottom" ...
##   .. ..$ wrapText       : logi [1:63] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ readingOrder   : chr [1:63] "context" "context" "context" "context" ...
##   .. ..$ indent         : int [1:63] 0 0 0 0 0 0 0 0 0 0 ...
##   .. ..$ justifyLastLine: logi [1:63] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ shrinkToFit    : logi [1:63] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. ..$ textRotation   : int [1:63] 0 0 0 0 0 0 0 0 0 0 ...
##   ..$ protection:List of 2
##   .. ..$ locked: logi [1:63] TRUE TRUE TRUE TRUE TRUE TRUE ...
##   .. ..$ hidden: logi [1:63] FALSE FALSE FALSE FALSE FALSE FALSE ...
##  $ style:List of 6
##   ..$ numFmt    : Named chr [1:43] "General" "General" "General" "General" ...
##   .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   ..$ font      :List of 10
##   .. ..$ bold     : Named logi [1:43] FALSE TRUE TRUE TRUE TRUE TRUE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ italic   : Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ underline: Named chr [1:43] NA NA NA NA ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ strike   : Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ vertAlign: Named chr [1:43] NA NA NA NA ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ size     : Named num [1:43] 11 18 15 13 11 11 11 11 11 11 ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ color    :List of 4
##   .. .. ..$ rgb    : Named chr [1:43] "FF000000" "FF1F497D" "FF1F497D" "FF1F497D" ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ theme  : Named chr [1:43] "text1" "text2" "text2" "text2" ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ name     : Named chr [1:43] "Calibri" "Cambria" "Calibri" "Calibri" ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ family   : Named int [1:43] 2 2 2 2 2 2 2 2 2 2 ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ scheme   : Named chr [1:43] "minor" "major" "minor" "minor" ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   ..$ fill      :List of 2
##   .. ..$ patternFill :List of 3
##   .. .. ..$ fgColor    :List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ bgColor    :List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ patternType: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ gradientFill:List of 8
##   .. .. ..$ type  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ degree: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ left  : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ right : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ top   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ bottom: Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ stop1 :List of 2
##   .. .. .. ..$ position: Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ color   :List of 4
##   .. .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ stop2 :List of 2
##   .. .. .. ..$ position: Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ color   :List of 4
##   .. .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   ..$ border    :List of 12
##   .. ..$ diagonalDown: Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ diagonalUp  : Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ outline     : Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ left        :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ right       :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ start       :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ end         :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ top         :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ bottom      :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA "thick" "thick" ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA "FF4F81BD" "FF4F81BD" ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA "accent1" "accent1" ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA 0.5 0.4 ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ diagonal    :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ vertical    :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ horizontal  :List of 2
##   .. .. ..$ style: Named chr [1:43] NA NA NA NA ...
##   .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. ..$ color:List of 4
##   .. .. .. ..$ rgb    : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ theme  : Named chr [1:43] NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ indexed: Named int [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. .. .. ..$ tint   : Named num [1:43] NA NA NA NA NA NA NA NA NA NA ...
##   .. .. .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   ..$ alignment :List of 8
##   .. ..$ horizontal     : Named chr [1:43] "general" "general" "general" "general" ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ vertical       : Named chr [1:43] "bottom" "bottom" "bottom" "bottom" ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ wrapText       : Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ readingOrder   : Named chr [1:43] "context" "context" "context" "context" ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ indent         : Named int [1:43] 0 0 0 0 0 0 0 0 0 0 ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ justifyLastLine: Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ shrinkToFit    : Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ textRotation   : Named int [1:43] 0 0 0 0 0 0 0 0 0 0 ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   ..$ protection:List of 2
##   .. ..$ locked: Named logi [1:43] TRUE TRUE TRUE TRUE TRUE TRUE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...
##   .. ..$ hidden: Named logi [1:43] FALSE FALSE FALSE FALSE FALSE FALSE ...
##   .. .. ..- attr(*, "names")= chr [1:43] "Normal" "Title" "Heading 1" "Heading 2" ...</code></pre>
<p>Why is this so complicated? For one thing, there are too many types of formatting available to include in the data frame given by <code><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells()</a></code>.</p>
<p>Consider borders: each cell can have a border on each of its four sides, as well as through the middle of the cell horizontally, vertically, diagonally up and diagonally down. Each border can have its own colour and linetype. Colour can be expressed as an RGB value, a theme number with or without a tint, or an index number.</p>
<p>To express that in a data frame would take (4 sides + 4 through the middle) * (4 ways to express colour + 1 linetype) = 40 columns. Just for borders.</p>
<p>Instead, Excel dynamically defines combinations of formatting, as they occur, and gives ID numbers to those combinations. Each cell has a formatting ID, which is used to look up its particular combination of formats. Note that this means two cells that are both bold can have different formatting IDs, e.g. if one is also italic.</p>
<p>There is also a hierarchy of formatting. The first formatting to be applied is the ‘style’. Every cell has a style, which by default is the ‘normal’ style. You can reformat all cells of the ‘normal’ style at once by updating the ‘normal’ style. Style formats are available under <code>xlsx_formats()$style</code></p>
<p>When you modify the format of a particular cell, then that modification is local to that cell. The cell’s local formatting is available under <code>xlsx_formats()$local</code>. Both <code>$style</code> and <code>$local</code> have the same structure, so it’s easy to switch from checking a cell’s style-level formatting to its local formatting.</p>
<p>Here’s an example of looking up both the local bold formatting and the style-level bold formatting of a cell.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1">cells &lt;-</a>
<a class="sourceLine" id="cb267-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb267-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character, style_format, local_format_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb267-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(row <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, col <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb267-5" data-line-number="5">cells</a></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##     row   col character style_format local_format_id
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                  &lt;int&gt;
## 1     1     1 bold      Normal                     3</code></pre>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1">formats &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)</a>
<a class="sourceLine" id="cb269-2" data-line-number="2"></a>
<a class="sourceLine" id="cb269-3" data-line-number="3">local_bold &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold</a>
<a class="sourceLine" id="cb269-4" data-line-number="4">local_bold</a></code></pre></div>
<pre><code>##  [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [12] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [23] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [34] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [45] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
## [56] FALSE  TRUE FALSE  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1">style_bold &lt;-<span class="st"> </span>formats<span class="op">$</span>style<span class="op">$</span>font<span class="op">$</span>bold</a>
<a class="sourceLine" id="cb271-2" data-line-number="2">style_bold</a></code></pre></div>
<pre><code>##           Normal            Title        Heading 1        Heading 2 
##            FALSE             TRUE             TRUE             TRUE 
##        Heading 3        Heading 4             Good              Bad 
##             TRUE             TRUE            FALSE            FALSE 
##          Neutral            Input           Output      Calculation 
##            FALSE            FALSE             TRUE             TRUE 
##      Linked Cell       Check Cell     Warning Text             Note 
##            FALSE             TRUE            FALSE            FALSE 
## Explanatory Text            Total          Accent1    20% - Accent1 
##            FALSE             TRUE            FALSE            FALSE 
##    40% - Accent1    60% - Accent1          Accent2    20% - Accent2 
##            FALSE            FALSE            FALSE            FALSE 
##    40% - Accent2    60% - Accent2          Accent3    20% - Accent3 
##            FALSE            FALSE            FALSE            FALSE 
##    40% - Accent3    60% - Accent3          Accent4    20% - Accent4 
##            FALSE            FALSE            FALSE            FALSE 
##    40% - Accent4    60% - Accent4          Accent5    20% - Accent5 
##            FALSE            FALSE            FALSE            FALSE 
##    40% - Accent5    60% - Accent5          Accent6    20% - Accent6 
##            FALSE            FALSE            FALSE            FALSE 
##    40% - Accent6    60% - Accent6         Normal 2 
##            FALSE            FALSE            FALSE</code></pre>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(cells,</a>
<a class="sourceLine" id="cb273-2" data-line-number="2">       <span class="dt">style_bold =</span> style_bold[style_format],</a>
<a class="sourceLine" id="cb273-3" data-line-number="3">       <span class="dt">local_bold =</span> local_bold[local_format_id])</a></code></pre></div>
<pre><code>## # A tibble: 1 x 7
##     row   col character style_format local_format_id style_bold local_bold
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;                  &lt;int&gt; &lt;lgl&gt;      &lt;lgl&gt;     
## 1     1     1 bold      Normal                     3 FALSE      TRUE</code></pre>
<p>Most of the time you will use the local formatting. You only need to check the style formatting when styles have been used in the spreadsheet (rare) and you want to ignore any local modifications of that style for particular cells.</p>
<p>Conditional formatting is an obvious omission. It isn’t supported by tidyxl because it doesn’t encode any new information; it’s responds to cell values, which you already have. If you think you need it, feel free to open an <a href="https://github.com/nacnudus/tidyxl/issues">issue</a>.</p>
<div id="common-formats" class="section level3">
<h3 class="hasAnchor">
<a href="#common-formats" class="anchor"></a>Common formats</h3>
<p>This example shows how to look up the most common formats.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1">cells &lt;-</a>
<a class="sourceLine" id="cb275-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb275-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character, style_format, local_format_id, height, width)</a>
<a class="sourceLine" id="cb275-4" data-line-number="4"></a>
<a class="sourceLine" id="cb275-5" data-line-number="5">formats &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_formats">xlsx_formats</a></span>(path)</a>
<a class="sourceLine" id="cb275-6" data-line-number="6"></a>
<a class="sourceLine" id="cb275-7" data-line-number="7">bold &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>bold</a>
<a class="sourceLine" id="cb275-8" data-line-number="8">italic &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>italic</a>
<a class="sourceLine" id="cb275-9" data-line-number="9">underline &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>underline</a>
<a class="sourceLine" id="cb275-10" data-line-number="10">strikethrough &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>strike</a>
<a class="sourceLine" id="cb275-11" data-line-number="11">font_colour &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>color<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb275-12" data-line-number="12">fill_colour &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>fill<span class="op">$</span>patternFill<span class="op">$</span>fgColor<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb275-13" data-line-number="13">font_size &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>size</a>
<a class="sourceLine" id="cb275-14" data-line-number="14">font_name &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>font<span class="op">$</span>name</a>
<a class="sourceLine" id="cb275-15" data-line-number="15">border_colour &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>border<span class="op">$</span>right<span class="op">$</span>color<span class="op">$</span>rgb</a>
<a class="sourceLine" id="cb275-16" data-line-number="16">border_linetype &lt;-<span class="st"> </span>formats<span class="op">$</span>local<span class="op">$</span>border<span class="op">$</span>right<span class="op">$</span>style</a>
<a class="sourceLine" id="cb275-17" data-line-number="17"></a>
<a class="sourceLine" id="cb275-18" data-line-number="18"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(cells,</a>
<a class="sourceLine" id="cb275-19" data-line-number="19">       <span class="dt">bold =</span> bold[local_format_id],</a>
<a class="sourceLine" id="cb275-20" data-line-number="20">       <span class="dt">italic =</span> italic[local_format_id],</a>
<a class="sourceLine" id="cb275-21" data-line-number="21">       <span class="dt">underline =</span> underline[local_format_id],</a>
<a class="sourceLine" id="cb275-22" data-line-number="22">       <span class="dt">strikethrough =</span> strikethrough[local_format_id],</a>
<a class="sourceLine" id="cb275-23" data-line-number="23">       <span class="dt">font_colour =</span> font_colour[local_format_id],</a>
<a class="sourceLine" id="cb275-24" data-line-number="24">       <span class="dt">font_size =</span> font_size[local_format_id],</a>
<a class="sourceLine" id="cb275-25" data-line-number="25">       <span class="dt">font_name =</span> font_name[local_format_id],</a>
<a class="sourceLine" id="cb275-26" data-line-number="26">       <span class="dt">fill_colour =</span> fill_colour[local_format_id],</a>
<a class="sourceLine" id="cb275-27" data-line-number="27">       <span class="dt">border_colour =</span> border_colour[local_format_id],</a>
<a class="sourceLine" id="cb275-28" data-line-number="28">       <span class="dt">border_linetype =</span> border_linetype[local_format_id])</a></code></pre></div>
<pre><code>## # A tibble: 14 x 17
##      row   col character   style_format local_format_id height width bold 
##    &lt;int&gt; &lt;int&gt; &lt;chr&gt;       &lt;chr&gt;                  &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;
##  1     1     1 bold        Normal                     3   15.0  8.38 TRUE 
##  2     2     1 italic      Normal                     2   15.0  8.38 FALSE
##  3     3     1 underline   Normal                    50   15.0  8.38 FALSE
##  4     4     1 strikethro… Normal                    51   15.0  8.38 FALSE
##  5     5     1 red text    Normal                     4   15.0  8.38 FALSE
##  6     6     1 font size … Normal                    52   18.8  8.38 FALSE
##  7     7     1 font arial  Normal                    53   15.0  8.38 FALSE
##  8     8     1 yellow fill Normal                     5   15.0  8.38 FALSE
##  9     9     1 black bord… Normal                    36   15.8  8.38 FALSE
## 10    10     1 thick bord… Normal                    54   15.8  8.38 FALSE
## 11    11     1 dashed bor… Normal                    55   15.8  8.38 FALSE
## 12    12     1 row height… Normal                     1   30.0  8.38 FALSE
## 13    13     2 column wid… Normal                     1   15.0 17.4  FALSE
## 14    14     1 Bad' style  Bad                       56   15.0  8.38 FALSE
## # ... with 9 more variables: italic &lt;lgl&gt;, underline &lt;chr&gt;,
## #   strikethrough &lt;lgl&gt;, font_colour &lt;chr&gt;, font_size &lt;dbl&gt;,
## #   font_name &lt;chr&gt;, fill_colour &lt;chr&gt;, border_colour &lt;chr&gt;,
## #   border_linetype &lt;chr&gt;</code></pre>
</div>
<div id="in-cell-formatting" class="section level3">
<h3 class="hasAnchor">
<a href="#in-cell-formatting" class="anchor"></a>In-cell formatting</h3>
<p>The previous section was about formatting applied at the level of cells. What about when multiple formats are applied within a single cell? A single word in a string might be a different colour, to stand out.</p>
<p>Unlike cell-level formatting, in-cell formatting is very limited, so it can be provided as a data frame with the following columns.</p>
<ul>
<li>bold</li>
<li>italic</li>
<li>underline</li>
<li>strike</li>
<li>vertAlign</li>
<li>size</li>
<li>color_rgb</li>
<li>color_theme</li>
<li>color_indexed</li>
<li>color_tint</li>
<li>font</li>
<li>family</li>
<li>scheme</li>
</ul>
<p>There is one of these data frames for each cell, and they are kept in a list-column called <code>character_formatted</code>.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"in-cell formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(address, character_formatted)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 2
##   address character_formatted
##   &lt;chr&gt;   &lt;list&gt;             
## 1 A1      &lt;tibble [9 × 14]&gt;  
## 2 A3      &lt;tibble [1 × 14]&gt;  
## 3 B3      &lt;tibble [1 × 14]&gt;  
## 4 A4      &lt;tibble [1 × 14]&gt;  
## 5 B4      &lt;NULL&gt;             
## 6 A5      &lt;tibble [2 × 14]&gt;  
## 7 B5      &lt;NULL&gt;             
## 8 A6      &lt;tibble [1 × 14]&gt;  
## 9 B6      &lt;NULL&gt;</code></pre>
<p>The way to access these data frames is via <code><a href="http://www.rdocumentation.org/packages/tidyr/topics/unnest">tidyr::unnest()</a></code>. In this example, a single cell has a long string of words, where each word is formatted differently.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"in-cell formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(address <span class="op">==</span><span class="st"> "A1"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(address, character_formatted) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/unnest">unnest</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 9 x 15
##   address character      bold  italic underline strike vertAlign    size
##   &lt;chr&gt;   &lt;chr&gt;          &lt;lgl&gt; &lt;lgl&gt;  &lt;chr&gt;     &lt;lgl&gt;  &lt;chr&gt;       &lt;dbl&gt;
## 1 A1      in-cell:       NA    NA     &lt;NA&gt;      NA     &lt;NA&gt;          NA 
## 2 A1      bold,          TRUE  FALSE  &lt;NA&gt;      FALSE  &lt;NA&gt;           0.
## 3 A1      italic,        FALSE TRUE   &lt;NA&gt;      FALSE  &lt;NA&gt;           0.
## 4 A1      underline,     FALSE FALSE  single    FALSE  &lt;NA&gt;           0.
## 5 A1      strikethrough, FALSE FALSE  &lt;NA&gt;      TRUE   &lt;NA&gt;           0.
## 6 A1      superscript,   FALSE FALSE  &lt;NA&gt;      FALSE  superscript    0.
## 7 A1      red,           FALSE FALSE  &lt;NA&gt;      FALSE  &lt;NA&gt;           0.
## 8 A1      arial,         FALSE FALSE  &lt;NA&gt;      FALSE  &lt;NA&gt;           0.
## 9 A1      size 14        FALSE FALSE  &lt;NA&gt;      FALSE  &lt;NA&gt;           0.
## # ... with 7 more variables: color_rgb &lt;chr&gt;, color_theme &lt;int&gt;,
## #   color_indexed &lt;int&gt;, color_tint &lt;dbl&gt;, font &lt;chr&gt;, family &lt;int&gt;,
## #   scheme &lt;chr&gt;</code></pre>
<p>It’s hard to think of a plausible example, so what follows is an implausible one that nevertheless occurred in real life.</p>
</div>
<div id="multiple-pieces-of-information-in-a-single-cell-with-meaningful-formatting" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-pieces-of-information-in-a-single-cell-with-meaningful-formatting" class="anchor"></a>Multiple pieces of information in a single cell, with meaningful formatting</h3>
<p>The following table of products and their production readiness combines three pieces of information in a single cell.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"in-cell formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb281-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(address <span class="op">!=</span><span class="st"> "A1"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb281-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/rectify.html">rectify</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   `row/col` `1(A)`        `2(B)`
##       &lt;int&gt; &lt;chr&gt;         &lt;chr&gt; 
## 1         3 ID            Count 
## 2         4 A1-TEST       1     
## 3         5 A2-PRODUCTION 2     
## 4         6 A3-PRODUCTION 3</code></pre>
<p>In the <code>ID</code> column, the first section <code>"A1"</code>, <code>"A2"</code>, <code>"A3"</code> is the product ID. The second section <code>"TEST"</code>, <code>"PRODUCTION"</code> is the production readiness, and the formatting of <code>"TEST"</code> and <code>"PRODUCTION"</code> shows whether or not manufacturing failed. In the file, one of those strings is formatted red with a strikethrough, indicating failure.</p>
<p>One way to extract the formatting is by unnesting, as above, but in this case we can get away with mapping over the nested data frames and pulling out a single value.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1">strikethrough &lt;-</a>
<a class="sourceLine" id="cb283-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"in-cell formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb283-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(address <span class="op">!=</span><span class="st"> "A1"</span>, col <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb283-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">strikethrough =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_lgl</a></span>(character_formatted, <span class="op">~</span><span class="st"> </span><span class="kw">any</span>(.x<span class="op">$</span>strike))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb283-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character, strikethrough)</a></code></pre></div>
<p>This can then be joined onto the rest of the table, in the same way as the section “Already a tidy table but with meaningful formatting of single cells”.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb284-1" data-line-number="1">cells &lt;-</a>
<a class="sourceLine" id="cb284-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"in-cell formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(address <span class="op">!=</span><span class="st"> "A1"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric)</a>
<a class="sourceLine" id="cb284-5" data-line-number="5"></a>
<a class="sourceLine" id="cb284-6" data-line-number="6">strikethrough &lt;-</a>
<a class="sourceLine" id="cb284-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"in-cell formatting"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(address <span class="op">!=</span><span class="st"> "A1"</span>, col <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">strikethrough =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_lgl</a></span>(character_formatted, <span class="op">~</span><span class="st"> </span><span class="kw">any</span>(.x<span class="op">$</span>strike))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, strikethrough)</a>
<a class="sourceLine" id="cb284-11" data-line-number="11"></a>
<a class="sourceLine" id="cb284-12" data-line-number="12"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(cells, strikethrough, <span class="dt">by =</span> <span class="st">"row"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb284-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(ID, strikethrough, Count)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   ID            strikethrough Count
##   &lt;chr&gt;         &lt;lgl&gt;         &lt;dbl&gt;
## 1 A1-TEST       NA               1.
## 2 A2-PRODUCTION TRUE             2.
## 3 A3-PRODUCTION NA               3.</code></pre>
</div>
<div id="superscript-symbols-in-data-cells-to-reference-notes" class="section level3">
<h3 class="hasAnchor">
<a href="#superscript-symbols-in-data-cells-to-reference-notes" class="anchor"></a>Superscript symbols in data cells to reference notes</h3>
<p>This is pernicious. What was Paula’s score, in the table below?</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb286-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/readxl/topics/read_excel">read_excel</a></span>(path, <span class="dt">sheet =</span> <span class="st">"superscript symbols"</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   Name    Score
##   &lt;chr&gt;   &lt;chr&gt;
## 1 Paula   91   
## 2 Matilda 10</code></pre>
<p>The answer is, it’s not Paula, it’s Paul (superscript ‘a’), who scored 9 (superscript ‘1’).</p>
<p>This sort of thing is difficult to spot. There’s a clue in the ‘Score’ column, which has been coerced to character so that the author could enter the superscript ‘1’ (Excel doesn’t allow superscripts in numeric cells), But it would be easy to interpret that as an accident of translation, and simply coerce back to numeric with <code>as.integer()</code>.</p>
<p>With tidyxl, you can count the rows of each element of the <code>character_formatted</code> column to identify cells that have in-cell formatting.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb288-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"superscript symbols"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb288-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(data_type <span class="op">==</span><span class="st"> "character"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb288-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_int</a></span>(character_formatted, nrow) <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb288-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, character)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row   col character
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;    
## 1     2     1 Paula    
## 2     2     2 91</code></pre>
<p>The values and symbols can then be separated by assuming the value is the first string, and the symbol is the second.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb290-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"superscript symbols"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb290-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">character =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_chr</a></span>(character_formatted,</a>
<a class="sourceLine" id="cb290-3" data-line-number="3">                             <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.null</span>(.x), character, .x<span class="op">$</span>character[<span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb290-4" data-line-number="4">         <span class="dt">symbol =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/purrr/topics/map">map_chr</a></span>(character_formatted,</a>
<a class="sourceLine" id="cb290-5" data-line-number="5">                          <span class="op">~</span><span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">is.null</span>(.x), <span class="ot">NA</span>, .x<span class="op">$</span>character[<span class="dv">2</span>])),</a>
<a class="sourceLine" id="cb290-6" data-line-number="6">         <span class="dt">numeric =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(row <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>col <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span>data_type <span class="op">==</span><span class="st"> "character"</span>,</a>
<a class="sourceLine" id="cb290-7" data-line-number="7">                           <span class="kw">as.numeric</span>(character),</a>
<a class="sourceLine" id="cb290-8" data-line-number="8">                           numeric),</a>
<a class="sourceLine" id="cb290-9" data-line-number="9">         <span class="dt">character =</span> <span class="kw"><a href="http://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(<span class="kw">is.na</span>(numeric), character, <span class="ot">NA_character_</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb290-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, numeric, character, symbol)</a></code></pre></div>
<pre><code>## Warning in if_else(row &gt; 1 &amp; col == 2 &amp; data_type == "character",
## as.numeric(character), : NAs introduced by coercion</code></pre>
<pre><code>## # A tibble: 6 x 5
##     row   col numeric character symbol
##   &lt;int&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt; 
## 1     1     1     NA  Name      &lt;NA&gt;  
## 2     1     2     NA  Score     &lt;NA&gt;  
## 3     2     1     NA  Paul      a     
## 4     2     2      9. &lt;NA&gt;      1     
## 5     3     1     NA  Matilda   &lt;NA&gt;  
## 6     3     2     10. &lt;NA&gt;      &lt;NA&gt;</code></pre>
</div>
</div>
<div id="other-gotchas" class="section level2">
<h2 class="hasAnchor">
<a href="#other-gotchas" class="anchor"></a>Other gotchas</h2>
<div id="non-text-headers-e-g-dates" class="section level3">
<h3 class="hasAnchor">
<a href="#non-text-headers-e-g-dates" class="anchor"></a>Non-text headers e.g. dates</h3>
<p>At the time of writing, readxl doesn’t convert Excel dates to R dates when they are in the header row.</p>
<p>Using tidyxl and unpivotr, you can choose to make a cell of any data type into a tidy ‘header’, and you can reformat it as text before <code><a href="../reference/spatter.html">spatter()</a></code> turns it into the header of a data frame. Another way to format headers as part of the <code><a href="../reference/behead.html">behead()</a></code> will be shown later.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"non-text headers"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb293-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(W, name) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb293-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, <span class="st">`</span><span class="dt">academic-year</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb293-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="st">`</span><span class="dt">academic-year</span><span class="st">`</span> =<span class="st"> </span><span class="kw">strftime</span>(<span class="st">`</span><span class="dt">academic-year</span><span class="st">`</span>, <span class="st">"%Y"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb293-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, data_type, <span class="st">`</span><span class="dt">academic-year</span><span class="st">`</span>, name, numeric) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb293-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(<span class="st">`</span><span class="dt">academic-year</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb293-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   name     `2017` `2018`
##   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;
## 1 Matilda      4.     2.
## 2 Nicholas     3.     1.</code></pre>
<p>When a single set of headers is of mixed data types, e.g. some character and some date, <code><a href="../reference/behead.html">behead()</a></code> chooses the correct ones using the <code>data_type</code> column, before converting them all to text via <code>format()</code>.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"non-text headers"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb295-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb295-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##     row   col data_type character numeric date                header    
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;dttm&gt;              &lt;chr&gt;     
## 1     2     1 character Matilda       NA  NA                  Name      
## 2     2     2 numeric   &lt;NA&gt;           2. NA                  2018-01-01
## 3     2     3 numeric   &lt;NA&gt;           4. NA                  2017-01-01
## 4     3     1 character Nicholas      NA  NA                  Name      
## 5     3     2 numeric   &lt;NA&gt;           1. NA                  2018-01-01
## 6     3     3 numeric   &lt;NA&gt;           3. NA                  2017-01-01</code></pre>
<p>To format a header when a single set of headers are of mixed data types, you can specify a function for each data type in the call to <code><a href="../reference/behead.html">behead()</a></code>.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"non-text headers"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb297-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb297-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header, <span class="dt">date =</span> <span class="op">~</span><span class="st"> </span><span class="kw">strftime</span>(.x, <span class="st">"%Y"</span>), <span class="dt">character =</span> toupper)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 7
##     row   col data_type character numeric date                header
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;dttm&gt;              &lt;chr&gt; 
## 1     2     1 character Matilda       NA  NA                  NAME  
## 2     2     2 numeric   &lt;NA&gt;           2. NA                  2018  
## 3     2     3 numeric   &lt;NA&gt;           4. NA                  2017  
## 4     3     1 character Nicholas      NA  NA                  NAME  
## 5     3     2 numeric   &lt;NA&gt;           1. NA                  2018  
## 6     3     3 numeric   &lt;NA&gt;           3. NA                  2017</code></pre>
</div>
<div id="data-embedded-in-comments" class="section level3">
<h3 class="hasAnchor">
<a href="#data-embedded-in-comments" class="anchor"></a>Data embedded in comments</h3>
<p>Comment strings are availabe in the <code>comment</code> column, just like <code>character</code>. Comments can have formatting, but tidyxl doesn’t yet import the formatting. If you need this, please open an <a href="https://github.com/nacnudus/tidyxl/issues">issue</a>. It would probably be imported into a <code>comment_formatted</code> column, similarly to <code>character_formatted</code>.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"comments"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb299-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, comment) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb299-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, <span class="st">"header"</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 7
##     row   col data_type character numeric comment       header
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt; 
## 1     2     1 character Paul          NA  Absent Term 1 Name  
## 2     2     2 numeric   &lt;NA&gt;           9. Predicted     Score 
## 3     3     1 character Matilda       NA  &lt;NA&gt;          Name  
## 4     3     2 numeric   &lt;NA&gt;          10. &lt;NA&gt;          Score</code></pre>
<p>Comments apply to single cells, so follow the same procedure as “Already a tidy table but with meaningful formatting of single cells”.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" data-line-number="1">cells &lt;-</a>
<a class="sourceLine" id="cb301-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyxl/topics/xlsx_cells">xlsx_cells</a></span>(path, <span class="dt">sheet =</span> <span class="st">"comments"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb301-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, col, data_type, character, numeric, comment)</a>
<a class="sourceLine" id="cb301-4" data-line-number="4">cells</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##     row   col data_type character numeric comment      
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;        
## 1     1     1 character Name          NA  &lt;NA&gt;         
## 2     1     2 character Score         NA  &lt;NA&gt;         
## 3     2     1 character Paul          NA  Absent Term 1
## 4     2     2 numeric   &lt;NA&gt;           9. Predicted    
## 5     3     1 character Matilda       NA  &lt;NA&gt;         
## 6     3     2 numeric   &lt;NA&gt;          10. &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" data-line-number="1">values &lt;-</a>
<a class="sourceLine" id="cb303-2" data-line-number="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb303-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>comment) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb303-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb303-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>col) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb303-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/spatter.html">spatter</a></span>(header)</a>
<a class="sourceLine" id="cb303-7" data-line-number="7">values</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row Name    Score
##   &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1     2 Paul       9.
## 2     3 Matilda   10.</code></pre>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" data-line-number="1">comments &lt;-</a>
<a class="sourceLine" id="cb305-2" data-line-number="2"><span class="st">  </span>cells <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb305-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/behead.html">behead</a></span>(N, header) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb305-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">header =</span> <span class="kw">paste0</span>(header, <span class="st">"_comment"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb305-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(row, header, comment) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb305-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a></span>(header, comment)</a>
<a class="sourceLine" id="cb305-7" data-line-number="7">comments</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     row Name_comment  Score_comment
##   &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;        
## 1     2 Absent Term 1 Predicted    
## 2     3 &lt;NA&gt;          &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" data-line-number="1"><span class="kw"><a href="http://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(values, comments, <span class="dt">by =</span> <span class="st">"row"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb307-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="op">-</span>row)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##   Name    Score Name_comment  Score_comment
##   &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;         &lt;chr&gt;        
## 1 Paul       9. Absent Term 1 Predicted    
## 2 Matilda   10. &lt;NA&gt;          &lt;NA&gt;</code></pre>
</div>
</div>
<div id="todo" class="section level2">
<h2 class="hasAnchor">
<a href="#todo" class="anchor"></a>TODO:</h2>
<ul>
<li>Can’t unpivotr just work it out by magic?
<ul>
<li>adversarial example</li>
</ul>
</li>
<li>Data validation (tidyxl vignette?)</li>
<li>Other gotchas
<ul>
<li>Data embedded in formulas</li>
<li>Referring to named ranges</li>
</ul>
</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-packages">Load packages</a></li>
      <li><a href="#data">Data</a></li>
      <li><a href="#clean-tidy-tables">Clean, tidy tables</a></li>
      <li><a href="#tidy-tables-but-with-gotchas">Tidy tables but with gotchas</a></li>
      <li><a href="#already-a-tidy-table-but-with-meaningful-formatting-of-whole-rows">Already a tidy table but with meaningful formatting of whole rows</a></li>
      <li><a href="#already-a-tidy-table-but-with-meaningful-formatting-of-single-cells">Already a tidy table but with meaningful formatting of single cells</a></li>
      <li><a href="#more-than-one-kind-of-formatting-at-the-same-time">More than one kind of formatting at the same time</a></li>
      <li><a href="#already-a-tidy-table-but-with-text-sentinel-values-in-non-text-columns">Already a tidy table but with text sentinel values in non-text columns</a></li>
      <li><a href="#pivot-tables">Pivot tables</a></li>
      <li><a href="#simple-unpivoting">Simple unpivoting</a></li>
      <li><a href="#complex-unpivoting">Complex unpivoting</a></li>
      <li><a href="#small-multiples">Small multiples</a></li>
      <li><a href="#formatting">Formatting</a></li>
      <li><a href="#other-gotchas">Other gotchas</a></li>
      <li><a href="#todo">TODO:</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Duncan Garmonsway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
