---
title: "New Functions Testing"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
# Clear environment 
rm(list = ls())

# Load all packages 
devtools::load_all("C:/Users/ianmo/OneDrive/Documents/data/projects/unpivotr-dev/tidyxl")
devtools::load_all()

# Install packages
library("stringr")
library("purrr")
library(dplyr)
library(rlang)
library(magrittr)
```


```{r}
unpivotr_example("bball-examples.xlsx") %>%
  xlsx_cells_fmt(path = . , sheets = "Sheet1") %>% 
  locate_data(!is.na(numeric)) %>% 
  locate_header_groups(type = "col" , .groupings = groupings(fmt_font_bold,fmt_alignment_indent)) %>%
  locate_header_groups(type = "row" , .groupings = groupings(fmt_font_bold,fmt_alignment_indent)) %>%   
  migrate() 

unpivotr_example("bball-examples.xlsx") %>%
  xlsx_cells_fmt(path = . , sheets = "Sheet1") %>% 
  locate_header_groups(type = "col" , .groupings = groupings(fmt_font_bold,fmt_alignment_indent)) %>% 
  locate_header_groups(type = "row" , .groupings = groupings(fmt_font_bold,fmt_alignment_indent)) %>% 
  migrate() 

unpivotr_example("bball-examples.xlsx") %>%
  xlsx_cells_fmt(path = . , sheets = "Sheet1") %>% 
  behead_groups(type = "col" , .groupings = groupings(fmt_font_bold,fmt_alignment_indent)) %>% 
  behead_groups(type = "row" , .groupings = groupings(fmt_font_bold,fmt_alignment_indent)) %>% 
  attr("data_cells") %>% 
  select(row,col,contains("header"),contains("row"),.value) 

unpivotr_example("bball-examples.xlsx") %>%
  xlsx_cells_fmt(path = . , sheets = "Sheet1")  %>%
  locate_data(!is.na(numeric)) %>% 
  filter(row > 2) %>% 
  behead_dc("NNW","stat_type",types =data_type ) %>% 
  behead_dc("N","stat",types =data_type ) %>% 
  behead_dc("W","player",types =data_type ) %>% 
  attr("data_cells") %>% 
  select(row,col,contains("header"),stat_type,stat,player,contains("row"))

unpivotr_example("bball-examples.xlsx") %>%
  xlsx_cells_fmt(path = . , sheets = "Sheet1")  %>%
  filter(row > 2) %>% 
  locate("NNW","stat_type",types =data_type ) %>%
  locate("N","stat",types =data_type ) %>% 
  locate("W","player",types =data_type ) %>% 
  mutate(.direction = ifelse(!is.na(numeric),"data",.direction)) %>% 
  mutate(.value = ifelse(.direction == "data", coalesce(as.character(numeric),as.character(character)),.value)) %>% 
 migrate_ndc()

unpivotr_example("bball-examples.xlsx") %>%
  xlsx_cells_fmt(path = . , sheets = "Sheet1") %>% 
  filter(row >2 ) %>%
  locate_data(!is.na(numeric)) %>% 
  locate_dc("NNW","stat_type",types =data_type ) %>%
  locate_dc("N","stat",types =data_type ) %>%  
  locate_dc("W","player",types =data_type ) %>% 
  migrate() 

```



