---
title: "worked-examples testing"
author: "Ian"
date: "`r Sys.Date()`"
editor_options: 
  chunk_output_type: console
---


### Example 1 

```{r message=FALSE, warning=FALSE, paged.print=FALSE}
# Install required packages 
library(devtools)
install_github("nacnudus/unpivotr",ref = "ian")
library(unpivotr)
library(tidyverse)
library(tidyxl)
```

This vignette uses the `humanities` sheet from unpivotr's `worked-examples.xlsx` workbook.
```{r}
# Identify workbooks and sheet for example 
workbook_path <- unpivotr_example("worked-examples.xlsx")
sheet_name <- "clean"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>% 
  migrate()
```


```{r}
sheet_name <- "notes"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>% 
  migrate()

```

# Allow for missing row_labels
```{r}
sheet_name <- "highlights"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats, manual_value_references ="A2:B4") %>% 
  migrate()

```


```{r}
sheet_name <- "annotations"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>% 
  migrate()

```



```{r}
sheet_name <- "combined-highlights"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>% 
  migrate()
```


```{r}
sheet_name <- "highlight-hierarchy"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>% 
  migrate()
```


```{r}
sheet_name <- "sentinels"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats,manual_value_references = "B2:C5") %>% 
  migrate()
```



```{r}
sheet_name <- "transposed"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>% 
  migrate()
```

# Add function to change directions 
```{r}
sheet_name <- "pivot-annotations"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>%  
  migrate()
```

# Add function to change directions 
```{r}
sheet_name <- "pivot-annotations"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>%  
  migrate()
```


# Add function/argument to encorporate information from borders (e.g. borded_header_groups = TRUE)
```{r}
sheet_name <- "pivot-centre-aligned"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>%  
  migrate()
```


# Add function to change directions 
```{r}
sheet_name <- "pivot-notes"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>%  
  migrate()
```


### Appears to be bug with WNW and NNW
```{r}
sheet_name <- "pivot-hierarchy"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>%  
  migrate()
```


### Appears to be bug with WNW and NNW | bordered headers
```{r}
sheet_name <- "pivot-repeated-headers"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>%  
  migrate() 
```

### Appears to be bug with WNW and NNW | bordered headers
```{r}
sheet_name <- "pivot-header-within-data"

# Identify workbooks and sheet for example 
testsheet_df <-  xlsx_cells(path = workbook_path,sheets = sheet_name)
formats <-  xlsx_formats(workbook_path)

testsheet_df %>%  
  orientate_auto(formats) %>%  
  migrate() 
```